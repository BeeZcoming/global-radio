<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨çƒå¹¿æ’­ç”µå°åœ¨çº¿æ”¶å¬</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            padding-bottom: 120px;
        }

        .container {
            display: flex;
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
            gap: 20px;
        }

        header {
            text-align: center;
            padding: 20px 0;
            background: rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ff8a00, #e52e71);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 10px rgba(229, 46, 113, 0.5);
        }

        .tagline {
            font-size: 1.1rem;
            color: #aaa;
            margin-bottom: 10px;
        }

        .search-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            color: white;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s;
        }

        .search-box input:focus {
            border-color: #e52e71;
            box-shadow: 0 0 10px rgba(229, 46, 113, 0.5);
        }

        .search-box i {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #aaa;
        }

        .filter-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        select {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            color: white;
            font-size: 0.9rem;
            outline: none;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
        }

        select:focus {
            border-color: #ff8a00;
            box-shadow: 0 0 10px rgba(255, 138, 0, 0.5);
        }

        option {
            background: #302b63;
        }

        /* è‡ªå®šä¹‰å¤šåˆ—ä¸‹æ‹‰èœå• */
        .custom-select {
            position: relative;
            flex: 1;
            min-width: 120px;
        }

        .select-selected {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .select-selected:after {
            content: "â–¼";
            font-size: 0.7rem;
            transition: all 0.3s;
        }

        .select-selected.select-arrow-active:after {
            transform: rotate(180deg);
        }

        .select-selected:hover {
            border-color: #ff8a00;
        }

        .select-items {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            top: 100%;
            left: 0;
            right: 0;
            z-index: 99;
            max-height: 500px;
            overflow-y: auto;
            display: none;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .select-items.active {
            display: block;
        }

        .select-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 10px;
            padding-bottom: 8px;
        }

        .select-header .select-item {
            background: rgba(255, 138, 0, 0.15) !important;
            border: 1px solid rgba(255, 138, 0, 0.3) !important;
            font-weight: 600;
            margin-bottom: 5px;
            padding: 10px 12px;
        }

        .select-hot-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            margin-bottom: 15px;
        }

        .select-hot-grid .select-item {
            background: rgba(229, 46, 113, 0.1);
            border: 1px solid rgba(229, 46, 113, 0.2);
            text-align: center;
            padding: 8px 4px;
            font-size: 0.8rem;
            border-radius: 6px;
        }

        .select-hot-grid .select-item:hover {
            background: rgba(229, 46, 113, 0.2);
            transform: translateY(-1px);
        }

        .select-columns {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .select-category {
            margin-bottom: 0;
        }

        .category-title {
            font-size: 0.85rem;
            color: #ff8a00;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .select-item {
            padding: 6px 8px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s;
            font-size: 0.8rem;
            color: #ddd;
            margin-bottom: 4px;
        }

        .select-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(3px);
        }

        .select-item.active {
            background: rgba(255, 138, 0, 0.2);
            color: #ff8a00;
            font-weight: 500;
        }

        .hot-genre::after {
            content: " ğŸ”¥";
            font-size: 0.7rem;
        }

        .sidebar {
            flex: 0 0 350px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 10px 20px 0px 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            max-height: calc(100vh - 200px);
            overflow: hidden;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .map-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 10px 20px 20px 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
        }

        .section-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: #ff8a00;
        }

        .radio-list {
            flex: 1;
            overflow-y: auto;
            margin-top: 10px;
        }

        .radio-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 6px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            transition: all 0.3s;
            cursor: pointer;
            border: 1px solid transparent;
            position: relative;
            overflow: hidden;
            min-height: 60px;
        }

        .radio-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 138, 0, 0.3);
        }

        .radio-item.active {
            background: rgba(229, 46, 113, 0.2);
            border-color: rgba(229, 46, 113, 0.5);
        }

        .radio-flag {
            width: 30px;
            height: 20px;
            border-radius: 3px;
            margin-right: 10px;
            font-size: 1.2rem;
            text-align: center;
        }

        .radio-info {
            flex: 1;
            min-width: 0;
        }

        .radio-name {
            font-weight: 600;
            margin-bottom: 3px;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .radio-country, .radio-genre {
            font-size: 0.75rem;
            color: #aaa;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .play-btn {
            background: #e52e71;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .play-btn:hover {
            background: #ff8a00;
            transform: scale(1.1);
        }

        #map {
            flex: 1;
            width: 100%;
            height: 100%;
            min-height: 500px;
            border-radius: 10px;
            overflow: hidden;
        }

        .country-info {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .country-name {
            font-size: 1.2rem;
            color: #ff8a00;
            margin-bottom: 10px;
        }

        .player {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            display: flex;
            align-items: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
        }

        .player-info {
            flex: 1;
            margin-left: 20px;
        }

        .player-station {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .player-country {
            color: #aaa;
            font-size: 0.9rem;
        }

        .player-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .control-btn:hover {
            color: #ff8a00;
        }

        .play-pause {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #e52e71;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .play-pause:hover {
            background: #ff8a00;
        }

        .volume-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .volume-slider {
            width: 100px;
        }

        /* éŸ³è´¨é€‰æ‹©å™¨åœ¨æ’­æ”¾å™¨ä½ç½® */
        .quality-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: 10px;
        }

        .quality-select {
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            color: white;
            font-size: 0.8rem;
            outline: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quality-select:focus {
            border-color: #ff8a00;
        }

        .quality-indicator {
            font-size: 0.7rem;
            color: #aaa;
            margin-left: 5px;
        }

        .now-playing {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-right: 20px;
            padding: 10px 15px;
            background: rgba(255, 138, 0, 0.2);
            border-radius: 30px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 138, 0, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(255, 138, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 138, 0, 0); }
        }

        .now-playing i {
            color: #ff8a00;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #aaa;
        }

        .error {
            text-align: center;
            padding: 20px;
            color: #e52e71;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 0.8rem;
            color: #aaa;
        }

        .favorite-btn {
            background: none;
            border: none;
            color: #aaa;
            font-size: 1rem;
            cursor: pointer;
            margin-right: 8px;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .favorite-btn.active {
            color: #ff8a00;
        }

        .tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tab {
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
            font-size: 0.9rem;
        }

        .tab.active {
            color: #ff8a00;
            border-bottom: 2px solid #ff8a00;
        }

        .tab:hover {
            color: #ff8a00;
        }

        .tab-content {
            display: none;
            flex: 1;
            overflow-y: auto;
        }

        .tab-content.active {
            display: flex;
            flex-direction: column;
        }

        .history-item {
            display: flex;
            align-items: center;
            padding: 8px;
            margin-bottom: 6px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .history-time {
            font-size: 0.65rem;
            color: #aaa;
            margin-top: 2px;
        }

        .share-btn {
            background: none;
            border: none;
            color: #aaa;
            font-size: 1.2rem;
            cursor: pointer;
            margin-right: 10px;
            transition: all 0.3s;
            position: relative;
        }

        .share-btn:hover {
            color: #2196F3;
        }

        .share-menu {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 10px;
            padding: 10px;
            display: none;
            flex-direction: column;
            gap: 8px;
            min-width: 150px;
            z-index: 1001;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .share-menu.active {
            display: flex;
        }

        .share-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
            text-decoration: none;
        }

        .share-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .share-option i {
            width: 20px;
            text-align: center;
        }

        .load-more {
            text-align: center;
            padding: 15px 10px 25px 10px;
            margin-top: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
        }

        .load-more-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .load-more-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #ff8a00;
            transform: translateY(-2px);
        }

        .region-selector {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }

        .region-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #aaa;
            padding: 6px 8px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.75rem;
            flex: 1;
            text-align: center;
        }

        .region-btn.active {
            background: rgba(255, 138, 0, 0.2);
            color: #ff8a00;
            border-color: rgba(255, 138, 0, 0.5);
        }

        .region-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* æ•°æ®æºæ˜¾ç¤ºåœ¨ç”µå°åˆ—è¡¨å¹¶æ’å³å¯¹é½ */
        .data-source-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 5px;
            padding: 8px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-source {
            font-size: 0.7rem;
            color: #aaa;
            text-align: right;
            flex: 1;
        }

        /* è„‰å†²åŠ¨ç”»æ ·å¼ */
        .pulsing-marker {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* ä¼˜åŒ–åçš„æ¬¢è¿æç¤ºæ ·å¼ */
        .welcome-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 138, 0, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1002;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideDown 0.5s ease-out;
            max-width: 500px;
            width: 90%;
        }

        @keyframes slideDown {
            from { top: -100px; opacity: 0; }
            to { top: 20px; opacity: 1; }
        }

        .welcome-notification .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            margin-left: auto;
        }

        .welcome-content {
            flex: 1;
        }

        .welcome-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .welcome-details {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* åˆ†äº«æˆåŠŸæç¤º */
        .share-success {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(33, 150, 243, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1002;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: fadeInOut 3s ease-in-out;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
            20% { opacity: 1; transform: translateX(-50%) translateY(0); }
            80% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        }

        /* å¾®ä¿¡åˆ†äº«æŒ‡å¼• */
        .wechat-share-guide {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1003;
        }

        .wechat-share-guide > div {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* é€šçŸ¥æ ·å¼ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            z-index: 1002;
            max-width: 300px;
            animation: slideInRight 0.5s ease-out;
        }

        .notification.info {
            background: rgba(33, 150, 243, 0.9);
        }

        .notification.success {
            background: rgba(76, 175, 80, 0.9);
        }

        .notification.warning {
            background: rgba(255, 152, 0, 0.9);
        }

        .notification.error {
            background: rgba(244, 67, 54, 0.9);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* éª¨æ¶å±æ ·å¼ */
        .skeleton-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            animation: skeleton-pulse 1.5s ease-in-out infinite;
        }

        .skeleton-flag {
            width: 30px;
            height: 20px;
            border-radius: 3px;
            margin-right: 10px;
            background: rgba(255, 255, 255, 0.1);
        }

        .skeleton-info {
            flex: 1;
        }

        .skeleton-name {
            height: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin-bottom: 6px;
            width: 70%;
        }

        .skeleton-details {
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            width: 50%;
        }

        .skeleton-map {
            height: 500px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            animation: skeleton-pulse 1.5s ease-in-out infinite;
        }

        @keyframes skeleton-pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* ç¼“å†²æŒ‡ç¤ºå™¨ */
        .buffering {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* è·³è¿‡å¯¼èˆªé“¾æ¥ */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: #000;
            color: white;
            padding: 8px;
            z-index: 10000;
            text-decoration: none;
        }

        .skip-link:focus {
            top: 6px;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                flex: 1;
                max-height: 500px;
            }
            
            .map-container {
                min-height: 600px;
            }
            
            .select-columns {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .search-container {
                flex-direction: column;
            }
            
            .search-box {
                min-width: 100%;
            }
            
            .player {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .player-controls {
                width: 100%;
                justify-content: center;
            }
            
            .sidebar {
                flex: 0 0 auto;
            }
            
            body {
                padding-bottom: 160px;
            }

            .region-selector {
                flex-wrap: wrap;
            }

            .region-btn {
                flex: 0 0 calc(33.333% - 5px);
                min-height: 44px; /* æ›´å¤§çš„è§¦æ‘¸ç›®æ ‡ */
            }

            .select-columns {
                grid-template-columns: 1fr;
            }
            
            .select-hot-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .welcome-notification {
                top: 10px;
                left: 10px;
                right: 10px;
                transform: none;
                max-width: none;
            }

            .radio-item {
                min-height: 60px; /* æ›´å¤§çš„è§¦æ‘¸ç›®æ ‡ */
                padding: 12px 15px;
            }
            
            .play-btn {
                width: 44px;
                height: 44px; /* æ›´å¤§çš„æŒ‰é’® */
            }
        }
    </style>
</head>
<body>
    <!-- è·³è¿‡å¯¼èˆªé“¾æ¥ -->
    <a href="#main-content" class="skip-link">è·³è¿‡å¯¼èˆª</a>

    <header>
        <h1><i class="fas fa-globe-americas"></i> å…¨çƒå¹¿æ’­ç”µå°</h1>
        <p class="tagline">æ¢ç´¢ä¸–ç•Œå„åœ°çš„å¹¿æ’­ç”µå°ï¼Œéšæ—¶æ”¶å¬å…¨çƒå£°éŸ³</p>
    </header>

    <div class="container">
        <div class="sidebar">
            <h2 class="section-title">ç”µå°åˆ—è¡¨</h2>
            
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="search-input" placeholder="æœç´¢ç”µå°åç§°ã€å›½å®¶æˆ–ç”µå°åˆ†ç±»...">
                    <i class="fas fa-search"></i>
                </div>
            </div>
            
            <div class="region-selector">
                <button class="region-btn active" data-region="all">å…¨éƒ¨</button>
                <button class="region-btn" data-region="asia">äºšæ´²</button>
                <button class="region-btn" data-region="europe">æ¬§æ´²</button>
                <button class="region-btn" data-region="north-america">åŒ—ç¾æ´²</button>
                <button class="region-btn" data-region="south-america">å—ç¾æ´²</button>
                <button class="region-btn" data-region="africa">éæ´²</button>
                <button class="region-btn" data-region="oceania">å¤§æ´‹æ´²</button>
            </div>
            
            <div class="filter-container">
                <select id="country-filter">
                    <option value="">æ‰€æœ‰å›½å®¶</option>
                </select>
                <select id="language-filter">
                    <option value="">æ‰€æœ‰è¯­è¨€</option>
                </select>
                
                <!-- è‡ªå®šä¹‰åˆ†ç±»é€‰æ‹©å™¨ -->
                <div class="custom-select" id="genre-select">
                    <!-- å†…å®¹ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <div class="stats">
                <span id="total-stations">åŠ è½½ä¸­...</span>
                <span id="filtered-stations"></span>
            </div>
            
            <div class="tabs">
                <div class="tab active" data-tab="all">å…¨éƒ¨ç”µå°</div>
                <div class="tab" data-tab="favorites">æ”¶è—</div>
                <div class="tab" data-tab="history">æ’­æ”¾å†å²</div>
            </div>
            
            <div class="tab-content active" id="all-stations">
                <div class="radio-list" id="radio-list">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> æ­£åœ¨åŠ è½½ç”µå°åˆ—è¡¨...
                    </div>
                </div>
                <div class="load-more">
                    <button class="load-more-btn" id="load-more-btn" style="display: none;">åŠ è½½æ›´å¤šç”µå°</button>
                </div>
				<div class="data-source-container">
					<div></div>
					<div class="data-source" id="data-source">æ•°æ®æ¥æº: ZYDS.NET | åœ°åŒº: æ‰€æœ‰åœ°åŒº</div>
				</div>				
            </div>
            
            <div class="tab-content" id="favorites-stations">
                <div class="radio-list" id="favorites-list">
                    <div class="loading">æš‚æ— æ”¶è—çš„ç”µå°</div>
                </div>
            </div>
            
            <div class="tab-content" id="history-stations">
                <div class="radio-list" id="history-list">
                    <div class="loading">æš‚æ— æ’­æ”¾å†å²</div>
                </div>
            </div>
        </div>
        
        <div class="main-content" id="main-content">
            <div class="map-container">
                <h2 class="section-title">ä¸–ç•Œç”µå°åœ°å›¾</h2>
                <div id="map"></div>
                <div class="country-info">
                    <div class="country-name" id="selected-country">å…¨çƒç”µå°</div>
                    <p id="country-station-count">ç‚¹å‡»åœ°å›¾ä¸Šçš„æ ‡è®°æˆ–ä½¿ç”¨ç­›é€‰å™¨é€‰æ‹©ç”µå°</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="player">
        <div class="now-playing">
            <i class="fas fa-music"></i>
            <span>æ­£åœ¨æ’­æ”¾</span>
        </div>
        
        <div class="player-info">
            <div class="player-station" id="current-station">è¯·é€‰æ‹©ä¸€ä¸ªç”µå°å¼€å§‹æ’­æ”¾</div>
            <div class="player-country" id="current-country"></div>
        </div>
        
        <div class="player-controls">
            <button class="control-btn play-pause" id="play-pause-btn"><i class="fas fa-play"></i></button>
            <button class="control-btn stop-btn" id="stop-btn"><i class="fas fa-stop"></i></button>
            
            <div class="volume-container">
                <button class="control-btn volume-btn"><i class="fas fa-volume-up"></i></button>
                <input type="range" class="volume-slider" min="0" max="100" value="80">
            </div>

            <div class="quality-container">
                <span style="font-size: 0.8rem; color: #aaa;">éŸ³è´¨:</span>
                <select class="quality-select" id="quality-select">
                    <option value="auto">è‡ªåŠ¨</option>
                    <option value="high">é«˜éŸ³è´¨</option>
                    <option value="medium">ä¸­éŸ³è´¨</option>
                    <option value="low">ä½éŸ³è´¨</option>
                </select>
                <span class="quality-indicator" id="quality-indicator"></span>
            </div>

            <div class="share-container">
                <button class="control-btn share-btn" id="share-btn">
                    <i class="fas fa-share-alt"></i>
                </button>
                <div class="share-menu" id="share-menu">
                    <a href="#" class="share-option" data-platform="copy-link">
                        <i class="fas fa-link"></i>
                        <span>å¤åˆ¶åˆ†äº«é“¾æ¥</span>
                    </a>
                    <a href="#" class="share-option" data-platform="wechat">
                        <i class="fab fa-weixin"></i>
                        <span>å¾®ä¿¡</span>
                    </a>
                    <a href="#" class="share-option" data-platform="weibo">
                        <i class="fab fa-weibo"></i>
                        <span>å¾®åš</span>
                    </a>
                    <a href="#" class="share-option" data-platform="qq">
                        <i class="fab fa-qq"></i>
                        <span>QQ</span>
                    </a>
                    <a href="#" class="share-option" data-platform="twitter">
                        <i class="fab fa-twitter"></i>
                        <span>Twitter</span>
                    </a>
                    <a href="#" class="share-option" data-platform="facebook">
                        <i class="fab fa-facebook"></i>
                        <span>Facebook</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // æ¨¡å—åŒ–é‡æ„ - ä¸»åº”ç”¨ç±»
        class GlobalRadioApp {
            constructor() {
                this.stationManager = new StationManager();
                this.mapManager = new MapManager();
                this.audioManager = new AudioManager();
                this.uiManager = new UIManager(this);
                this.searchEngine = new SearchEngine();
                this.storageManager = new StorageManager();
                this.errorHandler = new ErrorHandler();
                
                this.currentRegion = 'all';
                this.currentQuality = 'auto';
                this.currentGenre = 'all';
                this.activeTab = 'all';
                this.displayedCount = 0;
                this.displayLimit = 200;
            }

            async init() {
                try {
                    // æ˜¾ç¤ºéª¨æ¶å±
                    this.uiManager.showSkeleton();
                    
                    // åˆå§‹åŒ–å„ä¸ªæ¨¡å—
                    await this.mapManager.init();
                    this.uiManager.initCustomSelect();
                    this.uiManager.attachEventListeners();
                    
                    // æ¸è¿›å¼åŠ è½½æ•°æ®
                    await this.loadData();
                    
                    // æ£€æŸ¥URLå‚æ•°
                    this.checkUrlParams();
                    
                } catch (error) {
                    this.errorHandler.handleInitError(error);
                }
            }

            async loadData() {
                // å…ˆåŠ è½½æ ¸å¿ƒæ•°æ®
                await this.stationManager.loadEssentialData();
                this.uiManager.updateStats();
                this.uiManager.renderRadioList();
                this.mapManager.updateMarkers(this.stationManager.getStations().slice(0, 50));
                
                // ç„¶ååŠ è½½å‰©ä½™æ•°æ®
                setTimeout(() => {
                    this.stationManager.loadRemainingData();
                    this.uiManager.updateStats();
                }, 1000);
            }

            checkUrlParams() {
                const urlParams = new URLSearchParams(window.location.search);
                const stationId = urlParams.get('station');
                
                if (stationId) {
                    setTimeout(() => {
                        const station = this.stationManager.getStationById(stationId);
                        if (station) {
                            this.uiManager.showWelcomeNotification(station);
                            this.audioManager.playStation(station);
                            this.uiManager.scrollToStation(stationId);
                        }
                    }, 1000);
                }
            }

            cleanup() {
                this.mapManager.cleanup();
                this.audioManager.cleanup();
                this.uiManager.cleanup();
            }
        }

        // ç”µå°ç®¡ç†ç±»
        class StationManager {
            constructor() {
                this.stations = [];
                this.filteredStations = [];
                this.displayedStations = [];
                this.favorites = [];
                this.history = [];
                this.countries = [];
                this.languages = [];
            }

            async loadEssentialData() {
                try {
                    // å°è¯•ä»ç¼“å­˜åŠ è½½
                    const cached = this.storageManager.getWithExpiry('essentialStations');
                    if (cached) {
                        this.stations = cached;
                        this.extractFilterOptions();
                        return;
                    }

                    // åŠ è½½æ ¸å¿ƒæ•°æ®ï¼ˆå‰50ä¸ªï¼‰
                    const stations = await this.loadRegionalData('all', 50);
                    this.processStationsData(stations);
                    
                    // ç¼“å­˜æ ¸å¿ƒæ•°æ®
                    this.storageManager.setWithExpiry('essentialStations', stations, 30 * 60 * 1000); // 30åˆ†é’Ÿ
                    
                } catch (error) {
                    throw new Error(`åŠ è½½æ ¸å¿ƒæ•°æ®å¤±è´¥: ${error.message}`);
                }
            }

            async loadRemainingData() {
                try {
                    const stations = await this.loadRegionalData('all');
                    this.processStationsData(stations);
                } catch (error) {
                    console.warn('åŠ è½½å‰©ä½™æ•°æ®å¤±è´¥:', error);
                }
            }

            async loadRegionalData(region = 'all', limit = null) {
                const DATA_SOURCES = {
                    asia: 'data/asia-stations.json',
                    europe: 'data/europe-stations.json',
                    'north-america': 'data/north-america-stations.json',
                    'south-america': 'data/south-america-stations.json',
                    africa: 'data/africa-stations.json',
                    oceania: 'data/oceania-stations.json'
                };

                let allStations = [];
                const seenUuids = new Set();
                
                const sourcesToLoad = region === 'all' ? Object.values(DATA_SOURCES) : [DATA_SOURCES[region]];
                
                for (const source of sourcesToLoad) {
                    try {
                        const response = await fetch(source);
                        if (!response.ok) continue;
                        
                        const data = await response.json();
                        const stations = data.stations || [];
                        
                        stations.forEach(station => {
                            if (station && station.stationuuid && !seenUuids.has(station.stationuuid)) {
                                seenUuids.add(station.stationuuid);
                                allStations.push(station);
                            }
                        });
                        
                    } catch (error) {
                        console.warn(`æ— æ³•åŠ è½½åœ°åŒºæ•°æ® ${source}:`, error);
                    }
                    
                    if (limit && allStations.length >= limit) {
                        break;
                    }
                }
                
                return limit ? allStations.slice(0, limit) : allStations;
            }

            processStationsData(stations) {
                const uniqueStationsMap = new Map();
                stations.forEach(station => {
                    if (station && station.stationuuid) {
                        uniqueStationsMap.set(station.stationuuid, station);
                    }
                });
                
                // åˆå¹¶æ–°æ•°æ®ï¼Œé¿å…é‡å¤
                const newStations = Array.from(uniqueStationsMap.values()).filter(station => 
                    station && (station.url_resolved || station.url)
                );
                
                // ä½¿ç”¨Setæ¥å»é‡
                const existingIds = new Set(this.stations.map(s => s.stationuuid));
                const uniqueNewStations = newStations.filter(station => !existingIds.has(station.stationuuid));
                
                this.stations = [...this.stations, ...uniqueNewStations];
                this.filteredStations = [...this.stations];
                this.extractFilterOptions();
            }

            extractFilterOptions() {
                this.extractCountries();
                this.extractLanguages();
            }

            extractCountries() {
                const countrySet = new Set();
                this.stations.forEach(station => {
                    if (station.country) {
                        const chineseName = this.getChineseCountryName(station.country);
                        countrySet.add(chineseName);
                    }
                });
                this.countries = Array.from(countrySet).sort();
            }

            extractLanguages() {
                const languageSet = new Set();
                const languageMapping = {
                    'chinese': 'ä¸­æ–‡', 'english': 'è‹±è¯­', 'french': 'æ³•è¯­', 'russian': 'ä¿„è¯­',
                    'spanish': 'è¥¿ç­ç‰™è¯­', 'arabic': 'é˜¿æ‹‰ä¼¯è¯­', 'german': 'å¾·è¯­', 'japanese': 'æ—¥è¯­'
                };
                
                this.stations.forEach(station => {
                    if (station.language) {
                        const stationLanguages = station.language.split(',').map(lang => lang.trim().toLowerCase());
                        stationLanguages.forEach(lang => {
                            if (lang && languageMapping[lang]) {
                                languageSet.add(languageMapping[lang]);
                            }
                        });
                    }
                });
                this.languages = Array.from(languageSet).sort();
            }

            getChineseCountryName(englishName) {
                const countryNameMapping = {
                    'China': 'ä¸­å›½', 'United States': 'ç¾å›½', 'United Kingdom': 'è‹±å›½', 'Japan': 'æ—¥æœ¬',
                    'Germany': 'å¾·å›½', 'France': 'æ³•å›½', 'Australia': 'æ¾³å¤§åˆ©äºš', 'Canada': 'åŠ æ‹¿å¤§',
                    'Brazil': 'å·´è¥¿', 'Russia': 'ä¿„ç½—æ–¯'
                };
                return countryNameMapping[englishName] || englishName;
            }

            getStations() {
                return this.stations;
            }

            getStationById(id) {
                return this.stations.find(station => station.stationuuid === id);
            }

            filterStations(criteria) {
                this.filteredStations = this.stations.filter(station => {
                    const matchesSearch = !criteria.searchTerm || 
                        (station.name && station.name.toLowerCase().includes(criteria.searchTerm)) ||
                        (station.country && station.country.toLowerCase().includes(criteria.searchTerm)) ||
                        (station.tags && station.tags.toLowerCase().includes(criteria.searchTerm));
                    
                    const matchesCountry = !criteria.country || 
                        this.getChineseCountryName(station.country) === criteria.country;
                    
                    return matchesSearch && matchesCountry;
                });
                
                return this.filteredStations;
            }

            addToHistory(station) {
                const existingIndex = this.history.findIndex(item => 
                    item.station.stationuuid === station.stationuuid
                );
                
                if (existingIndex !== -1) {
                    this.history.splice(existingIndex, 1);
                }
                
                this.history.push({
                    station: station,
                    timestamp: Date.now()
                });
                
                if (this.history.length > 50) {
                    this.history = this.history.slice(-50);
                }
                
                this.storageManager.setWithExpiry('radioHistory', this.history);
            }

            toggleFavorite(stationId) {
                const station = this.getStationById(stationId);
                if (!station) return false;
                
                const index = this.favorites.findIndex(fav => fav.stationuuid === stationId);
                
                if (index === -1) {
                    this.favorites.push(station);
                } else {
                    this.favorites.splice(index, 1);
                }
                
                this.storageManager.setWithExpiry('radioFavorites', this.favorites);
                return index === -1; // è¿”å›æ˜¯å¦æ·»åŠ äº†æ”¶è—
            }
        }

        // åœ°å›¾ç®¡ç†ç±»
        class MapManager {
            constructor() {
                this.map = null;
                this.markers = [];
                this.markerLayer = null;
            }

            init() {
                return new Promise((resolve) => {
                    this.map = L.map('map').setView([20, 0], 3);
                    
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                    }).addTo(this.map);
                    
                    this.markerLayer = L.layerGroup().addTo(this.map);
                    resolve();
                });
            }

            updateMarkers(stations) {
                // æ¸…é™¤ç°æœ‰æ ‡è®°
                this.markerLayer.clearLayers();
                this.markers = [];
                
                const displayLimit = 100; // é™åˆ¶æ ‡è®°æ•°é‡ä»¥æé«˜æ€§èƒ½
                const stationsToShow = stations.slice(0, displayLimit);
                
                // ä½¿ç”¨requestAnimationFrameåˆ†æ‰¹å¤„ç†
                this.processMarkersBatch(stationsToShow, 0, 20);
            }

            processMarkersBatch(stations, startIndex, batchSize) {
                const endIndex = Math.min(startIndex + batchSize, stations.length);
                
                for (let i = startIndex; i < endIndex; i++) {
                    const station = stations[i];
                    if (station.geo_lat && station.geo_long) {
                        this.createMarker(station);
                    }
                }
                
                if (endIndex < stations.length) {
                    requestAnimationFrame(() => {
                        this.processMarkersBatch(stations, endIndex, batchSize);
                    });
                }
            }

            createMarker(station) {
                const flagEmoji = this.getFlagEmoji(station.countrycode);
                const countryName = app.stationManager.getChineseCountryName(station.country);
                
                const marker = L.marker([station.geo_lat, station.geo_long])
                    .addTo(this.markerLayer)
                    .bindPopup(`
                        <div style="color: black; min-width: 200px;">
                            <b>${station.name || 'æœªçŸ¥ç”µå°'}</b><br>
                            ${countryName || ''}<br>
                            <small>${this.formatGenres(station.tags)}</small><br>
                            <button onclick="app.audioManager.playStation('${station.stationuuid}')" 
                                    style="background:#e52e71;color:white;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;margin-top:5px;">
                                æ’­æ”¾
                            </button>
                        </div>
                    `);
                
                marker.on('click', () => {
                    app.audioManager.playStation(station.stationuuid);
                });
                
                this.markers.push(marker);
                return marker;
            }

            getFlagEmoji(countryCode) {
                if (!countryCode) return 'ğŸŒ';
                const codePoints = countryCode.toUpperCase().split('').map(char => 127397 + char.charCodeAt());
                return String.fromCodePoint(...codePoints);
            }

            formatGenres(tags) {
                if (!tags) return 'æœªåˆ†ç±»';
                const genreList = tags.split(',').slice(0, 2);
                return genreList.join(' Â· ');
            }

            cleanup() {
                if (this.map) {
                    this.map.remove();
                    this.map = null;
                }
                this.markers = [];
            }
        }

        // éŸ³é¢‘ç®¡ç†ç±»
        class AudioManager {
            constructor() {
                this.audio = new Audio();
                this.currentStation = null;
                this.isPlaying = false;
                this.retryCount = 0;
                this.maxRetries = 3;
                this.setupAudioEvents();
            }

            setupAudioEvents() {
                this.audio.addEventListener('waiting', () => this.showBuffering());
                this.audio.addEventListener('canplay', () => this.hideBuffering());
                this.audio.addEventListener('error', (e) => this.handleError(e));
                this.audio.addEventListener('ended', () => this.onPlaybackEnded());
                this.audio.addEventListener('loadstart', () => this.onLoadStart());
            }

            async playStation(stationId) {
                const station = app.stationManager.getStationById(stationId);
                if (!station) {
                    this.errorHandler.showNotification('æœªæ‰¾åˆ°è¯¥ç”µå°', 'error');
                    return;
                }

                this.currentStation = station;
                app.uiManager.updatePlayerInfo(station);
                app.stationManager.addToHistory(station);

                try {
                    await this.playWithRetry(station);
                    this.isPlaying = true;
                    app.uiManager.updatePlayButton(true);
                } catch (error) {
                    this.errorHandler.handleStationError(error, station);
                }
            }

            async playWithRetry(station, retryCount = 0) {
                const streamUrl = station.url_resolved || station.url;
                if (!streamUrl) {
                    throw new Error('ç”µå°æ²¡æœ‰æœ‰æ•ˆçš„æµåª’ä½“URL');
                }

                try {
                    this.audio.src = streamUrl;
                    await this.audio.play();
                    this.retryCount = 0;
                } catch (error) {
                    if (retryCount < this.maxRetries) {
                        await this.delay(1000 * (retryCount + 1));
                        return this.playWithRetry(station, retryCount + 1);
                    }
                    throw error;
                }
            }

            togglePlayPause() {
                if (!this.currentStation) return;

                if (this.isPlaying) {
                    this.audio.pause();
                    this.isPlaying = false;
                } else {
                    this.audio.play().catch(error => {
                        this.errorHandler.handleStationError(error, this.currentStation);
                    });
                    this.isPlaying = true;
                }
                app.uiManager.updatePlayButton(this.isPlaying);
            }

            stop() {
                this.audio.pause();
                this.audio.currentTime = 0;
                this.isPlaying = false;
                app.uiManager.updatePlayButton(false);
            }

            setVolume(volume) {
                this.audio.volume = volume / 100;
            }

            showBuffering() {
                app.uiManager.showBufferingIndicator();
            }

            hideBuffering() {
                app.uiManager.hideBufferingIndicator();
            }

            onLoadStart() {
                this.retryCount = 0;
            }

            onPlaybackEnded() {
                this.isPlaying = false;
                app.uiManager.updatePlayButton(false);
            }

            handleError(error) {
                console.error('Audio error:', error);
                if (this.retryCount < this.maxRetries) {
                    this.retryCount++;
                    setTimeout(() => {
                        if (this.currentStation) {
                            this.playWithRetry(this.currentStation, this.retryCount);
                        }
                    }, 1000 * this.retryCount);
                } else {
                    this.errorHandler.handleStationError(error, this.currentStation);
                }
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            cleanup() {
                this.audio.pause();
                this.audio.src = '';
                this.audio = null;
            }
        }

        // UIç®¡ç†ç±»
        class UIManager {
            constructor(app) {
                this.app = app;
                this.eventListeners = [];
                this.debounceTimeouts = new Map();
            }

            initCustomSelect() {
                const customSelect = document.getElementById('genre-select');
                customSelect.innerHTML = `
                    <div class="select-selected" style="font-weight: bold; color: #ff8a00;">æ‰€æœ‰åˆ†ç±»</div>
                    <div class="select-items">
                        <div class="select-header">
                            <div class="select-item active" data-value="all" style="background: rgba(255, 138, 0, 0.2); font-weight: bold;">
                                <i class="fas fa-globe"></i> æ‰€æœ‰åˆ†ç±»
                            </div>
                        </div>
                        <div class="select-category">
                            <div class="category-title"><i class="fas fa-fire"></i> çƒ­é—¨åˆ†ç±»</div>
                            <div class="select-hot-grid">
                                <div class="select-item hot-genre" data-value="æµè¡ŒéŸ³ä¹">æµè¡ŒéŸ³ä¹</div>
                                <div class="select-item hot-genre" data-value="æ–°é—»èµ„è®¯">æ–°é—»èµ„è®¯</div>
                                <div class="select-item hot-genre" data-value="æ‘‡æ»šéŸ³ä¹">æ‘‡æ»šéŸ³ä¹</div>
                                <div class="select-item hot-genre" data-value="è°ˆè¯èŠ‚ç›®">è°ˆè¯èŠ‚ç›®</div>
                                <div class="select-item hot-genre" data-value="å¤å…¸éŸ³ä¹">å¤å…¸éŸ³ä¹</div>
                                <div class="select-item hot-genre" data-value="ä½“è‚²èŠ‚ç›®">ä½“è‚²èŠ‚ç›®</div>
                            </div>
                        </div>
                    </div>
                `;
                
                this.setupCustomSelectEvents(customSelect);
            }

            setupCustomSelectEvents(customSelect) {
                const selectSelected = customSelect.querySelector('.select-selected');
                const selectItems = customSelect.querySelector('.select-items');
                const selectItemsAll = customSelect.querySelectorAll('.select-item');
                
                this.addEventListener(selectSelected, 'click', (e) => {
                    e.stopPropagation();
                    selectItems.classList.toggle('active');
                    selectSelected.classList.toggle('select-arrow-active');
                });
                
                selectItemsAll.forEach(item => {
                    this.addEventListener(item, 'click', () => {
                        selectItemsAll.forEach(i => i.classList.remove('active'));
                        item.classList.add('active');
                        selectSelected.textContent = item.textContent;
                        selectItems.classList.remove('active');
                        selectSelected.classList.remove('select-arrow-active');
                        this.app.currentGenre = item.dataset.value;
                        this.performSearch();
                    });
                });
            }

            attachEventListeners() {
                // æœç´¢ç›¸å…³
                this.addEventListener(document.getElementById('search-input'), 'input', 
                    this.debounce(() => this.performSearch(), 300));
                
                this.addEventListener(document.getElementById('country-filter'), 'change', 
                    () => this.performSearch());
                
                this.addEventListener(document.getElementById('language-filter'), 'change', 
                    () => this.performSearch());
                
                // æ’­æ”¾æ§åˆ¶
                this.addEventListener(document.getElementById('play-pause-btn'), 'click', 
                    () => this.app.audioManager.togglePlayPause());
                
                this.addEventListener(document.getElementById('stop-btn'), 'click', 
                    () => this.app.audioManager.stop());
                
                this.addEventListener(document.querySelector('.volume-slider'), 'input', 
                    (e) => this.app.audioManager.setVolume(e.target.value));
                
                // éŸ³è´¨é€‰æ‹©
                this.addEventListener(document.getElementById('quality-select'), 'change', 
                    (e) => {
                        this.app.currentQuality = e.target.value;
                        this.performSearch();
                    });
                
                // åˆ†äº«åŠŸèƒ½
                this.addEventListener(document.getElementById('share-btn'), 'click', 
                    () => this.toggleShareMenu());
                
                // æ ‡ç­¾é¡µåˆ‡æ¢
                document.querySelectorAll('.tab').forEach(tab => {
                    this.addEventListener(tab, 'click', () => {
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                        
                        tab.classList.add('active');
                        const tabId = tab.dataset.tab;
                        document.getElementById(`${tabId}-stations`).classList.add('active');
                        
                        this.app.activeTab = tabId;
                        this.updateTabs();
                    });
                });
                
                // åœ°åŒºé€‰æ‹©
                document.querySelectorAll('.region-btn').forEach(btn => {
                    this.addEventListener(btn, 'click', async () => {
                        document.querySelectorAll('.region-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.app.currentRegion = btn.dataset.region;
                        
                        this.showSkeleton();
                        await this.app.stationManager.loadRegionalData(this.app.currentRegion);
                        this.performSearch();
                    });
                });
            }

            addEventListener(element, type, handler) {
                element.addEventListener(type, handler);
                this.eventListeners.push({ element, type, handler });
            }

            debounce(func, wait) {
                return (...args) => {
                    const key = func.toString();
                    clearTimeout(this.debounceTimeouts.get(key));
                    this.debounceTimeouts.set(key, setTimeout(() => func.apply(this, args), wait));
                };
            }

            performSearch() {
                const searchTerm = document.getElementById('search-input').value.toLowerCase();
                const countryFilter = document.getElementById('country-filter').value;
                
                const criteria = {
                    searchTerm,
                    country: countryFilter,
                    genre: this.app.currentGenre,
                    quality: this.app.currentQuality,
                    region: this.app.currentRegion
                };
                
                const filteredStations = this.app.stationManager.filterStations(criteria);
                this.renderRadioList(filteredStations);
                this.app.mapManager.updateMarkers(filteredStations.slice(0, 100));
                this.updateStats();
            }

            renderRadioList(stations = null) {
                const container = document.getElementById('radio-list');
                const stationsToRender = stations || this.app.stationManager.filteredStations;
                
                if (stationsToRender.length === 0) {
                    container.innerHTML = '<div class="loading">æœªæ‰¾åˆ°åŒ¹é…çš„ç”µå°</div>';
                    return;
                }
                
                container.innerHTML = '';
                
                stationsToRender.slice(0, this.app.displayLimit).forEach(station => {
                    const radioItem = this.createRadioItem(station);
                    container.appendChild(radioItem);
                });
                
                this.attachRadioItemEvents();
            }

            createRadioItem(station) {
                const flagEmoji = this.app.mapManager.getFlagEmoji(station.countrycode);
                const isFavorite = this.app.stationManager.favorites.some(fav => fav.stationuuid === station.stationuuid);
                const countryName = this.app.stationManager.getChineseCountryName(station.country);
                const isActive = this.app.audioManager.currentStation?.stationuuid === station.stationuuid;
                
                const radioItem = document.createElement('div');
                radioItem.className = `radio-item ${isActive ? 'active' : ''}`;
                radioItem.dataset.id = station.stationuuid;
                radioItem.setAttribute('role', 'button');
                radioItem.setAttribute('tabindex', '0');
                radioItem.setAttribute('aria-label', `æ’­æ”¾ ${station.name}, æ¥è‡ª${countryName}çš„ç”µå°`);
                
                radioItem.innerHTML = `
                    <button class="favorite-btn ${isFavorite ? 'active' : ''}" 
                            data-id="${station.stationuuid}"
                            aria-pressed="${isFavorite}"
                            aria-label="${isFavorite ? 'å–æ¶ˆæ”¶è—' : 'æ”¶è—'}è¯¥ç”µå°">
                        <i class="fas fa-heart"></i>
                    </button>
                    <div class="radio-flag">${flagEmoji}</div>
                    <div class="radio-info">
                        <div class="radio-name">${station.name || 'æœªçŸ¥ç”µå°'}</div>
                        <div class="radio-country">${countryName || 'æœªçŸ¥å›½å®¶'}</div>
                        <div class="radio-genre">${this.formatGenres(station.tags)}</div>
                    </div>
                    <button class="play-btn" data-id="${station.stationuuid}" aria-label="æ’­æ”¾ç”µå°">
                        <i class="fas fa-play"></i>
                    </button>
                `;
                
                return radioItem;
            }

            attachRadioItemEvents() {
                document.querySelectorAll('.play-btn').forEach(btn => {
                    this.addEventListener(btn, 'click', (e) => {
                        e.stopPropagation();
                        const stationId = btn.dataset.id;
                        this.app.audioManager.playStation(stationId);
                    });
                });
                
                document.querySelectorAll('.favorite-btn').forEach(btn => {
                    this.addEventListener(btn, 'click', (e) => {
                        e.stopPropagation();
                        const stationId = btn.dataset.id;
                        const isNowFavorite = this.app.stationManager.toggleFavorite(stationId);
                        btn.classList.toggle('active', isNowFavorite);
                        btn.setAttribute('aria-pressed', isNowFavorite);
                    });
                });
                
                document.querySelectorAll('.radio-item').forEach(item => {
                    this.addEventListener(item, 'click', () => {
                        const stationId = item.dataset.id;
                        this.app.audioManager.playStation(stationId);
                    });
                    
                    // é”®ç›˜å¯¼èˆªæ”¯æŒ
                    this.addEventListener(item, 'keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            const stationId = item.dataset.id;
                            this.app.audioManager.playStation(stationId);
                        }
                    });
                });
            }

            formatGenres(tags) {
                if (!tags) return 'æœªåˆ†ç±»';
                const genreList = tags.split(',').slice(0, 2);
                return genreList.join(' Â· ');
            }

            updateStats() {
                const stations = this.app.stationManager.getStations();
                const filteredStations = this.app.stationManager.filteredStations;
                
                const totalDisplay = `${stations.length.toLocaleString()} ç”µå° / ${this.app.stationManager.countries.length} å›½å®¶`;
                document.getElementById('total-stations').textContent = totalDisplay;
                
                const displayedCountText = `æ˜¾ç¤º: ${Math.min(this.app.displayLimit, filteredStations.length)}/${filteredStations.length}`;
                document.getElementById('filtered-stations').textContent = displayedCountText;
            }

            updatePlayerInfo(station) {
                document.getElementById('current-station').textContent = station.name || 'æœªçŸ¥ç”µå°';
                const countryName = this.app.stationManager.getChineseCountryName(station.country);
                document.getElementById('current-country').textContent = `${countryName || 'æœªçŸ¥å›½å®¶'} â€¢ ${this.formatGenres(station.tags)}`;
                
                // æ›´æ–°æ´»è·ƒçŠ¶æ€
                document.querySelectorAll('.radio-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.id === station.stationuuid) {
                        item.classList.add('active');
                    }
                });
            }

            updatePlayButton(isPlaying) {
                const playPauseBtn = document.getElementById('play-pause-btn');
                playPauseBtn.innerHTML = isPlaying ? '<i class="fas fa-pause"></i>' : '<i class="fas fa-play"></i>';
            }

            showBufferingIndicator() {
                let indicator = document.querySelector('.buffering');
                if (!indicator) {
                    indicator = document.createElement('div');
                    indicator.className = 'buffering';
                    document.querySelector('.player-info').appendChild(indicator);
                }
            }

            hideBufferingIndicator() {
                const indicator = document.querySelector('.buffering');
                if (indicator) {
                    indicator.remove();
                }
            }

            showSkeleton() {
                const container = document.getElementById('radio-list');
                container.innerHTML = `
                    <div class="skeleton-item">
                        <div class="skeleton-flag"></div>
                        <div class="skeleton-info">
                            <div class="skeleton-name"></div>
                            <div class="skeleton-details"></div>
                        </div>
                    </div>
                `.repeat(10);
            }

            showWelcomeNotification(station) {
                const existingNotification = document.querySelector('.welcome-notification');
                if (existingNotification) {
                    existingNotification.remove();
                }
                
                const countryName = this.app.stationManager.getChineseCountryName(station.country);
                const genre = this.formatGenres(station.tags);
                const notification = document.createElement('div');
                notification.className = 'welcome-notification';
                notification.innerHTML = `
                    <i class="fas fa-broadcast-tower"></i>
                    <div class="welcome-content">
                        <div class="welcome-title">æ¬¢è¿æ”¶å¬æœ‹å‹åˆ†äº«çš„ç”µå°</div>
                        <div class="welcome-details">
                            ${station.name} Â· ${countryName} Â· ${genre}
                        </div>
                    </div>
                    <button class="close-btn"><i class="fas fa-times"></i></button>
                `;
                
                document.body.appendChild(notification);
                
                this.addEventListener(notification.querySelector('.close-btn'), 'click', () => {
                    notification.remove();
                });
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 8000);
            }

            scrollToStation(stationId) {
                const radioList = document.getElementById('radio-list');
                const stationElement = radioList.querySelector(`[data-id="${stationId}"]`);
                
                if (stationElement) {
                    stationElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    stationElement.style.backgroundColor = 'rgba(255, 138, 0, 0.2)';
                    
                    setTimeout(() => {
                        stationElement.style.backgroundColor = '';
                    }, 3000);
                }
            }

            toggleShareMenu() {
                const shareMenu = document.getElementById('share-menu');
                shareMenu.classList.toggle('active');
            }

            updateTabs() {
                if (this.app.activeTab === 'favorites') {
                    this.renderRadioList(this.app.stationManager.favorites);
                } else if (this.app.activeTab === 'history') {
                    this.renderHistoryList();
                }
            }

            renderHistoryList() {
                const historyList = document.getElementById('history-list');
                const history = this.app.stationManager.history;
                
                if (history.length === 0) {
                    historyList.innerHTML = '<div class="loading">æš‚æ— æ’­æ”¾å†å²</div>';
                    return;
                }
                
                historyList.innerHTML = '';
                const recentHistory = history.slice(-20).reverse();
                
                recentHistory.forEach(item => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.dataset.id = item.station.stationuuid;
                    
                    const flagEmoji = this.app.mapManager.getFlagEmoji(item.station.countrycode);
                    const timeString = new Date(item.timestamp).toLocaleString();
                    const countryName = this.app.stationManager.getChineseCountryName(item.station.country);
                    
                    historyItem.innerHTML = `
                        <div class="radio-flag">${flagEmoji}</div>
                        <div class="radio-info">
                            <div class="radio-name">${item.station.name || 'æœªçŸ¥ç”µå°'}</div>
                            <div class="radio-country">${countryName || 'æœªçŸ¥å›½å®¶'}</div>
                            <div class="history-time">${timeString}</div>
                        </div>
                        <button class="play-btn" data-id="${item.station.stationuuid}">
                            <i class="fas fa-play"></i>
                        </button>
                    `;
                    
                    historyList.appendChild(historyItem);
                });
                
                this.attachRadioItemEvents();
            }

            cleanup() {
                // æ¸…ç†æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
                this.eventListeners.forEach(({ element, type, handler }) => {
                    element.removeEventListener(type, handler);
                });
                this.eventListeners = [];
                
                // æ¸…ç†é˜²æŠ–å®šæ—¶å™¨
                this.debounceTimeouts.forEach(timeout => clearTimeout(timeout));
                this.debounceTimeouts.clear();
            }
        }

        // æœç´¢å¼•æ“ç±»
        class SearchEngine {
            constructor() {
                this.index = null;
            }

            buildIndex(stations) {
                // ç®€åŒ–çš„æœç´¢ç´¢å¼•å®ç°
                this.index = stations.map(station => ({
                    ...station,
                    searchableText: `${station.name} ${station.country} ${station.tags} ${station.language}`.toLowerCase()
                }));
            }

            search(query) {
                if (!this.index || !query) return this.index || [];
                
                const searchTerms = query.toLowerCase().split(' ');
                return this.index.filter(station => {
                    return searchTerms.every(term => station.searchableText.includes(term));
                });
            }
        }

        // å­˜å‚¨ç®¡ç†ç±»
        class StorageManager {
            setWithExpiry(key, value, ttl = 24 * 60 * 60 * 1000) {
                try {
                    const item = {
                        value: this.compress(value),
                        expiry: Date.now() + ttl
                    };
                    localStorage.setItem(key, JSON.stringify(item));
                } catch (error) {
                    console.warn('å­˜å‚¨æ•°æ®å¤±è´¥:', error);
                    // å¦‚æœå­˜å‚¨å¤±è´¥ï¼Œå°è¯•ä¸ä½¿ç”¨å‹ç¼©
                    try {
                        const item = {
                            value: value,
                            expiry: Date.now() + ttl
                        };
                        localStorage.setItem(key, JSON.stringify(item));
                    } catch (e) {
                        console.error('å­˜å‚¨æ•°æ®å½»åº•å¤±è´¥:', e);
                    }
                }
            }

            getWithExpiry(key) {
                try {
                    const itemStr = localStorage.getItem(key);
                    if (!itemStr) return null;
                    
                    const item = JSON.parse(itemStr);
                    if (Date.now() > item.expiry) {
                        localStorage.removeItem(key);
                        return null;
                    }
                    
                    return this.decompress(item.value);
                } catch (error) {
                    console.warn('è¯»å–å­˜å‚¨æ•°æ®å¤±è´¥:', error);
                    return null;
                }
            }

            compress(obj) {
                try {
                    return LZString.compress(JSON.stringify(obj));
                } catch (error) {
                    console.warn('å‹ç¼©æ•°æ®å¤±è´¥ï¼Œè¿”å›åŸå§‹æ•°æ®:', error);
                    return obj;
                }
            }

            decompress(str) {
                try {
                    if (typeof str === 'string' && str.startsWith('{"')) {
                        return JSON.parse(str);
                    }
                    return JSON.parse(LZString.decompress(str));
                } catch (error) {
                    console.warn('è§£å‹ç¼©æ•°æ®å¤±è´¥ï¼Œè¿”å›åŸå§‹æ•°æ®:', error);
                    return str;
                }
            }
        }

        // é”™è¯¯å¤„ç†ç±»
        class ErrorHandler {
            handleInitError(error) {
                console.error('åº”ç”¨åˆå§‹åŒ–å¤±è´¥:', error);
                this.showNotification('åº”ç”¨åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
            }

            handleStationError(error, station) {
                console.error('Station error:', error, station);
                
                let message = `æ— æ³•æ’­æ”¾ ${station?.name || 'è¯¥ç”µå°'}ï¼Œè¯·å°è¯•å…¶ä»–ç”µå°`;
                
                if (error.message.includes('Failed to fetch')) {
                    message = 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®';
                } else if (error.message.includes('404')) {
                    message = 'ç”µå°èµ„æºä¸å­˜åœ¨æˆ–å·²å¤±æ•ˆ';
                }
                
                this.showNotification(message, 'error');
            }

            showNotification(message, type = 'info') {
                // ç§»é™¤å¯èƒ½å·²å­˜åœ¨çš„é€šçŸ¥
                const existingNotification = document.querySelector('.notification');
                if (existingNotification) {
                    existingNotification.remove();
                }
                
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 5000);
            }
        }

        // åˆ†äº«åŠŸèƒ½
        function shareStation(platform) {
            if (!app.audioManager.currentStation) {
                app.errorHandler.showNotification('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç”µå°', 'warning');
                return;
            }
            
            const station = app.audioManager.currentStation;
            const stationName = station.name;
            const countryName = app.stationManager.getChineseCountryName(station.country);
            const genre = app.uiManager.formatGenres(station.tags);
            
            const shareUrl = `${window.location.origin}${window.location.pathname}?station=${station.stationuuid}`;
            const shareText = `ğŸ§ æˆ‘æ­£åœ¨é€šè¿‡å…¨çƒå¹¿æ’­ç”µå°æ”¶å¬ ${stationName} (${countryName}) - ${genre}`;
            const fullShareContent = `${shareText}\n\nğŸ“» ç”µå°æµåª’ä½“åœ°å€: ${shareUrl}\nğŸŒ å‘ç°æ›´å¤šå…¨çƒç”µå°: ${window.location.origin}${window.location.pathname}`;
            
            switch(platform) {
                case 'copy-link':
                    navigator.clipboard.writeText(fullShareContent).then(() => {
                        app.errorHandler.showNotification('ç”µå°ä¿¡æ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
                    }).catch(() => {
                        const textArea = document.createElement('textarea');
                        textArea.value = fullShareContent;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        app.errorHandler.showNotification('ç”µå°ä¿¡æ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
                    });
                    break;
                case 'wechat':
                    showWechatShareGuide(fullShareContent);
                    break;
                default:
                    app.errorHandler.showNotification('åˆ†äº«åŠŸèƒ½å¼€å‘ä¸­', 'info');
            }
            
            document.getElementById('share-menu').classList.remove('active');
        }

        function showWechatShareGuide(content) {
            const modal = document.createElement('div');
            modal.className = 'wechat-share-guide';
            
            const guideBox = document.createElement('div');
            guideBox.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <i class="fab fa-weixin" style="font-size: 3rem; color: #09BB07;"></i>
                </div>
                <h3 style="color: #ff8a00; margin-bottom: 15px;">å¾®ä¿¡åˆ†äº«æŒ‡å¼•</h3>
                <p style="margin-bottom: 15px; line-height: 1.5;">
                    è¯·å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼Œç„¶ååœ¨å¾®ä¿¡ä¸­ç²˜è´´åˆ†äº«ç»™æœ‹å‹ï¼š
                </p>
                <div style="background: rgba(0, 0, 0, 0.3); padding: 10px; border-radius: 5px; margin-bottom: 15px; text-align: left;">
                    <pre style="white-space: pre-wrap; font-family: monospace; font-size: 0.8rem; margin: 0; color: white;">${content}</pre>
                </div>
                <button id="copy-wechat-btn" style="background: #09BB07; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; width: 100%;">
                    <i class="fas fa-copy"></i> å¤åˆ¶å†…å®¹
                </button>
                <button id="close-wechat-btn" style="background: none; color: #aaa; border: none; padding: 10px; cursor: pointer; width: 100%; margin-top: 10px;">
                    å–æ¶ˆ
                </button>
            `;
            
            modal.appendChild(guideBox);
            document.body.appendChild(modal);
            
            document.getElementById('copy-wechat-btn').addEventListener('click', () => {
                navigator.clipboard.writeText(content).then(() => {
                    app.errorHandler.showNotification('å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
                    modal.remove();
                });
            });
            
            document.getElementById('close-wechat-btn').addEventListener('click', () => modal.remove());
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // å…¨å±€åº”ç”¨å®ä¾‹
        const app = new GlobalRadioApp();

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });

        // é¡µé¢å¸è½½æ—¶æ¸…ç†èµ„æº
        window.addEventListener('beforeunload', () => {
            app.cleanup();
        });

        // å¯¼å‡ºåˆ°å…¨å±€ï¼Œä¾›HTMLäº‹ä»¶ä½¿ç”¨
        window.shareStation = shareStation;
        window.app = app;
    </script>
</body>
</html>
