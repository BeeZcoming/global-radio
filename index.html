<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨çƒå¹¿æ’­ç”µå°åœ¨çº¿æ”¶å¬</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            padding-bottom: 120px;
        }

        .container {
            display: flex;
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
            gap: 20px;
        }

        header {
            text-align: center;
            padding: 20px 0;
            background: rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ff8a00, #e52e71);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 10px rgba(229, 46, 113, 0.5);
        }

        .tagline {
            font-size: 1.1rem;
            color: #aaa;
            margin-bottom: 10px;
        }

        .search-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            color: white;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s;
        }

        .search-box input:focus {
            border-color: #e52e71;
            box-shadow: 0 0 10px rgba(229, 46, 113, 0.5);
        }

        .search-box i {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #aaa;
        }

        .filter-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        select {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            color: white;
            font-size: 0.9rem;
            outline: none;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
        }

        select:focus {
            border-color: #ff8a00;
            box-shadow: 0 0 10px rgba(255, 138, 0, 0.5);
        }

        option {
            background: #302b63;
        }

        /* è‡ªå®šä¹‰å¤šåˆ—ä¸‹æ‹‰èœå• */
        .custom-select {
            position: relative;
            flex: 1;
            min-width: 120px;
        }

        .select-selected {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .select-selected:after {
            content: "â–¼";
            font-size: 0.7rem;
            transition: all 0.3s;
        }

        .select-selected.select-arrow-active:after {
            transform: rotate(180deg);
        }

        .select-selected:hover {
            border-color: #ff8a00;
        }

        .select-items {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            top: 100%;
            left: 0;
            right: 0;
            z-index: 99;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            padding: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .select-items.active {
            display: block;
        }

        .select-columns {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .select-category {
            margin-bottom: 10px;
        }

        .category-title {
            font-size: 0.8rem;
            color: #ff8a00;
            margin-bottom: 5px;
            padding-bottom: 3px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .select-item {
            padding: 6px 10px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.8rem;
            color: #ddd;
        }

        .select-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .select-item.active {
            background: rgba(255, 138, 0, 0.2);
            color: #ff8a00;
        }

        .hot-genre::after {
            content: " ğŸ”¥";
        }

        .sidebar {
            flex: 0 0 350px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            max-height: calc(100vh - 200px);
            overflow: hidden;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .map-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
        }

        .section-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: #ff8a00;
        }

        .radio-list {
            flex: 1;
            overflow-y: auto;
            margin-top: 10px;
        }

        .radio-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 6px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            transition: all 0.3s;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .radio-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 138, 0, 0.3);
        }

        .radio-item.active {
            background: rgba(229, 46, 113, 0.2);
            border-color: rgba(229, 46, 113, 0.5);
        }

        .radio-flag {
            width: 30px;
            height: 20px;
            border-radius: 3px;
            margin-right: 10px;
            font-size: 1.2rem;
            text-align: center;
        }

        .radio-info {
            flex: 1;
            min-width: 0;
        }

        .radio-name {
            font-weight: 600;
            margin-bottom: 3px;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .radio-country, .radio-genre {
            font-size: 0.75rem;
            color: #aaa;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .play-btn {
            background: #e52e71;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .play-btn:hover {
            background: #ff8a00;
            transform: scale(1.1);
        }

        #map {
            flex: 1;
            width: 100%;
            height: 100%;
            min-height: 500px;
            border-radius: 10px;
            overflow: hidden;
        }

        .country-info {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .country-name {
            font-size: 1.2rem;
            color: #ff8a00;
            margin-bottom: 10px;
        }

        .player {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            display: flex;
            align-items: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
        }

        .player-info {
            flex: 1;
            margin-left: 20px;
        }

        .player-station {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .player-country {
            color: #aaa;
            font-size: 0.9rem;
        }

        .player-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .control-btn:hover {
            color: #ff8a00;
        }

        .play-pause {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #e52e71;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .play-pause:hover {
            background: #ff8a00;
        }

        .volume-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .volume-slider {
            width: 100px;
        }

        /* éŸ³è´¨é€‰æ‹©å™¨åœ¨æ’­æ”¾å™¨ä½ç½® */
        .quality-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: 10px;
        }

        .quality-select {
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            color: white;
            font-size: 0.8rem;
            outline: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quality-select:focus {
            border-color: #ff8a00;
        }

        .quality-indicator {
            font-size: 0.7rem;
            color: #aaa;
            margin-left: 5px;
        }

        .now-playing {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-right: 20px;
            padding: 10px 15px;
            background: rgba(255, 138, 0, 0.2);
            border-radius: 30px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 138, 0, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(255, 138, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 138, 0, 0); }
        }

        .now-playing i {
            color: #ff8a00;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #aaa;
        }

        .error {
            text-align: center;
            padding: 20px;
            color: #e52e71;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 0.8rem;
            color: #aaa;
        }

        .favorite-btn {
            background: none;
            border: none;
            color: #aaa;
            font-size: 1rem;
            cursor: pointer;
            margin-right: 8px;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .favorite-btn.active {
            color: #ff8a00;
        }

        .tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tab {
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
            font-size: 0.9rem;
        }

        .tab.active {
            color: #ff8a00;
            border-bottom: 2px solid #ff8a00;
        }

        .tab:hover {
            color: #ff8a00;
        }

        .tab-content {
            display: none;
            flex: 1;
            overflow-y: auto;
        }

        .tab-content.active {
            display: flex;
            flex-direction: column;
        }

        .history-item {
            display: flex;
            align-items: center;
            padding: 8px;
            margin-bottom: 6px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .history-time {
            font-size: 0.65rem;
            color: #aaa;
            margin-top: 2px;
        }

        .share-btn {
            background: none;
            border: none;
            color: #aaa;
            font-size: 1.2rem;
            cursor: pointer;
            margin-right: 10px;
            transition: all 0.3s;
            position: relative;
        }

        .share-btn:hover {
            color: #2196F3;
        }

        .share-menu {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 10px;
            padding: 10px;
            display: none;
            flex-direction: column;
            gap: 8px;
            min-width: 150px;
            z-index: 1001;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .share-menu.active {
            display: flex;
        }

        .share-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
            text-decoration: none;
        }

        .share-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .share-option i {
            width: 20px;
            text-align: center;
        }

        .load-more {
            text-align: center;
            padding: 15px 10px 25px 10px;
            margin-top: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
        }

        .load-more-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .load-more-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #ff8a00;
            transform: translateY(-2px);
        }

        .region-selector {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }

        .region-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #aaa;
            padding: 6px 8px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.75rem;
            flex: 1;
            text-align: center;
        }

        .region-btn.active {
            background: rgba(255, 138, 0, 0.2);
            color: #ff8a00;
            border-color: rgba(255, 138, 0, 0.5);
        }

        .region-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* æ•°æ®æºæ˜¾ç¤ºåœ¨ç”µå°åˆ—è¡¨å¹¶æ’å³å¯¹é½ */
        .data-source-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 5px;
            padding: 8px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-source {
            font-size: 0.7rem;
            color: #aaa;
            text-align: right;
            flex: 1;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                flex: 1;
                max-height: 500px;
            }
            
            .map-container {
                min-height: 600px;
            }
            
            .select-columns {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .search-container {
                flex-direction: column;
            }
            
            .search-box {
                min-width: 100%;
            }
            
            .player {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .player-controls {
                width: 100%;
                justify-content: center;
            }
            
            .sidebar {
                flex: 0 0 auto;
            }
            
            body {
                padding-bottom: 160px;
            }

            .region-selector {
                flex-wrap: wrap;
            }

            .region-btn {
                flex: 0 0 calc(33.333% - 5px);
            }

            .select-columns {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1><i class="fas fa-globe-americas"></i> å…¨çƒå¹¿æ’­ç”µå°</h1>
        <p class="tagline">æ¢ç´¢ä¸–ç•Œå„åœ°çš„å¹¿æ’­ç”µå°ï¼Œéšæ—¶æ”¶å¬å…¨çƒå£°éŸ³</p>
    </header>

    <div class="container">
        <div class="sidebar">
            <h2 class="section-title">ç”µå°åˆ—è¡¨</h2>
            
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="search-input" placeholder="æœç´¢ç”µå°åç§°ã€å›½å®¶æˆ–ç±»å‹...">
                    <i class="fas fa-search"></i>
                </div>
            </div>
            
            <div class="region-selector">
                <button class="region-btn active" data-region="all">å…¨éƒ¨</button>
                <button class="region-btn" data-region="asia">äºšæ´²</button>
                <button class="region-btn" data-region="europe">æ¬§æ´²</button>
                <button class="region-btn" data-region="north-america">åŒ—ç¾æ´²</button>
                <button class="region-btn" data-region="south-america">å—ç¾æ´²</button>
                <button class="region-btn" data-region="africa">éæ´²</button>
                <button class="region-btn" data-region="oceania">å¤§æ´‹æ´²</button>
            </div>
            
            <div class="filter-container">
                <select id="country-filter">
                    <option value="">æ‰€æœ‰å›½å®¶</option>
                </select>
                <select id="language-filter">
                    <option value="">æ‰€æœ‰è¯­è¨€</option>
                </select>
                
                <!-- è‡ªå®šä¹‰ç±»å‹é€‰æ‹©å™¨ -->
                <div class="custom-select" id="genre-select">
                    <div class="select-selected">æ‰€æœ‰ç±»å‹</div>
                    <div class="select-items">
                        <div class="select-columns">
                            <div class="select-category">
                                <div class="category-title">éŸ³ä¹ç±»å‹</div>
                                <div class="select-item active" data-value="all">æ‰€æœ‰ç±»å‹</div>
                                <div class="select-item hot-genre" data-value="éŸ³ä¹">éŸ³ä¹</div>
                                <div class="select-item" data-value="æµè¡Œ">æµè¡Œ</div>
                                <div class="select-item" data-value="æ‘‡æ»š">æ‘‡æ»š</div>
                                <div class="select-item" data-value="å¤å…¸">å¤å…¸</div>
                                <div class="select-item" data-value="çˆµå£«">çˆµå£«</div>
                                <div class="select-item" data-value="ç”µå­">ç”µå­</div>
                                <div class="select-item" data-value="ä¹¡æ‘">ä¹¡æ‘</div>
                                <div class="select-item" data-value="æ°‘è°£">æ°‘è°£</div>
                                <div class="select-item" data-value="è“è°ƒ">è“è°ƒ</div>
                            </div>
                            <div class="select-category">
                                <div class="category-title">èµ„è®¯ç±»å‹</div>
                                <div class="select-item hot-genre" data-value="æ–°é—»">æ–°é—»</div>
                                <div class="select-item" data-value="è°ˆè¯">è°ˆè¯</div>
                                <div class="select-item" data-value="ä½“è‚²">ä½“è‚²</div>
                                <div class="select-item" data-value="è´¢ç»">è´¢ç»</div>
                                <div class="select-item" data-value="æ”¿æ²»">æ”¿æ²»</div>
                                <div class="select-item" data-value="å¤©æ°”">å¤©æ°”</div>
                                <div class="select-item" data-value="äº¤é€š">äº¤é€š</div>
                            </div>
                            <div class="select-category">
                                <div class="category-title">å…¶ä»–ç±»å‹</div>
                                <div class="select-item" data-value="æ•™è‚²">æ•™è‚²</div>
                                <div class="select-item" data-value="æ–‡åŒ–">æ–‡åŒ–</div>
                                <div class="select-item" data-value="å®—æ•™">å®—æ•™</div>
                                <div class="select-item" data-value="å¨±ä¹">å¨±ä¹</div>
                                <div class="select-item" data-value="å–œå‰§">å–œå‰§</div>
                                <div class="select-item" data-value="ç”Ÿæ´»">ç”Ÿæ´»</div>
                                <div class="select-item" data-value="å¥åº·">å¥åº·</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="stats">
                <span id="total-stations">åŠ è½½ä¸­...</span>
                <span id="filtered-stations"></span>
            </div>
            
            <!-- æ•°æ®æºæ˜¾ç¤ºåŒºåŸŸ -->
            <div class="data-source-container">
                <div></div> <!-- å ä½å…ƒç´  -->
                <div class="data-source" id="data-source">æ•°æ®æ¥æº: æœ¬åœ°æ•°æ®</div>
            </div>
            
            <div class="tabs">
                <div class="tab active" data-tab="all">å…¨éƒ¨ç”µå°</div>
                <div class="tab" data-tab="favorites">æ”¶è—</div>
                <div class="tab" data-tab="history">æ’­æ”¾å†å²</div>
            </div>
            
            <div class="tab-content active" id="all-stations">
                <div class="radio-list" id="radio-list">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> æ­£åœ¨åŠ è½½ç”µå°åˆ—è¡¨...
                    </div>
                </div>
                <div class="load-more">
                    <button class="load-more-btn" id="load-more-btn" style="display: none;">åŠ è½½æ›´å¤šç”µå°</button>
                </div>
            </div>
            
            <div class="tab-content" id="favorites-stations">
                <div class="radio-list" id="favorites-list">
                    <div class="loading">æš‚æ— æ”¶è—çš„ç”µå°</div>
                </div>
            </div>
            
            <div class="tab-content" id="history-stations">
                <div class="radio-list" id="history-list">
                    <div class="loading">æš‚æ— æ’­æ”¾å†å²</div>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="map-container">
                <h2 class="section-title">ä¸–ç•Œåœ°å›¾</h2>
                <div id="map"></div>
                <div class="country-info">
                    <div class="country-name" id="selected-country">å…¨çƒç”µå°</div>
                    <p id="country-station-count">ç‚¹å‡»åœ°å›¾ä¸Šçš„æ ‡è®°æˆ–ä½¿ç”¨ç­›é€‰å™¨é€‰æ‹©ç”µå°</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="player">
        <div class="now-playing">
            <i class="fas fa-music"></i>
            <span>æ­£åœ¨æ’­æ”¾</span>
        </div>
        
        <div class="player-info">
            <div class="player-station" id="current-station">è¯·é€‰æ‹©ä¸€ä¸ªç”µå°å¼€å§‹æ’­æ”¾</div>
            <div class="player-country" id="current-country"></div>
        </div>
        
        <div class="player-controls">
            <button class="control-btn play-pause" id="play-pause-btn"><i class="fas fa-play"></i></button>
            <button class="control-btn stop-btn" id="stop-btn"><i class="fas fa-stop"></i></button>
            
            <div class="volume-container">
                <button class="control-btn volume-btn"><i class="fas fa-volume-up"></i></button>
                <input type="range" class="volume-slider" min="0" max="100" value="80">
            </div>

            <!-- éŸ³è´¨é€‰æ‹©å™¨ç§»åŠ¨åˆ°æ’­æ”¾å™¨ä½ç½® -->
            <div class="quality-container">
                <span style="font-size: 0.8rem; color: #aaa;">éŸ³è´¨:</span>
                <select class="quality-select" id="quality-select">
                    <option value="auto">è‡ªåŠ¨</option>
                    <option value="high">é«˜éŸ³è´¨</option>
                    <option value="medium">ä¸­éŸ³è´¨</option>
                    <option value="low">ä½éŸ³è´¨</option>
                </select>
                <span class="quality-indicator" id="quality-indicator"></span>
            </div>

            <div class="share-container">
                <button class="control-btn share-btn" id="share-btn">
                    <i class="fas fa-share-alt"></i>
                </button>
                <div class="share-menu" id="share-menu">
                    <a href="#" class="share-option" data-platform="wechat">
                        <i class="fab fa-weixin"></i>
                        <span>å¾®ä¿¡</span>
                    </a>
                    <a href="#" class="share-option" data-platform="weibo">
                        <i class="fab fa-weibo"></i>
                        <span>å¾®åš</span>
                    </a>
                    <a href="#" class="share-option" data-platform="qq">
                        <i class="fab fa-qq"></i>
                        <span>QQ</span>
                    </a>
                    <a href="#" class="share-option" data-platform="zhihu">
                        <i class="fab fa-zhihu"></i>
                        <span>çŸ¥ä¹</span>
                    </a>
                    <a href="#" class="share-option" data-platform="redbook">
                        <i class="fas fa-book"></i>
                        <span>å°çº¢ä¹¦</span>
                    </a>
                    <a href="#" class="share-option" data-platform="twitter">
                        <i class="fab fa-twitter"></i>
                        <span>Twitter</span>
                    </a>
                    <a href="#" class="share-option" data-platform="facebook">
                        <i class="fab fa-facebook"></i>
                        <span>Facebook</span>
                    </a>
                    <a href="#" class="share-option" data-platform="copy">
                        <i class="fas fa-link"></i>
                        <span>å¤åˆ¶é“¾æ¥</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // åˆå§‹åŒ–å˜é‡
        let currentStation = null;
        let isPlaying = false;
        let audioPlayer = new Audio();
        let allStations = [];
        let filteredStations = [];
        let displayedStations = [];
        let favoriteStations = [];
        let historyStations = [];
        let map;
        let markers = [];
        let countries = [];
        let languages = [];
        let genres = [];
        let searchTimeout;
        let activeTab = 'all';
        let currentRegion = 'all';
        let currentQuality = 'auto';
        let currentGenre = 'all';
        let displayLimit = 200;
        let displayedCount = 0;

        // æ•°æ®æºé…ç½® - 7ä¸ªæ´²
        const DATA_SOURCES = {
            primary: 'data/curated-stations.json',
            asia: 'data/asia-stations.json',
            europe: 'data/europe-stations.json',
            'north-america': 'data/north-america-stations.json',
            'south-america': 'data/south-america-stations.json',
            africa: 'data/africa-stations.json',
            oceania: 'data/oceania-stations.json',
            fallback: 'https://de1.api.radio-browser.info/json/stations?limit=100&hidebroken=true&order=votes&reverse=true'
        };

        // æ‰©å±•è¯­è¨€æ˜ å°„
        const languageMapping = {
            'chinese': 'ä¸­æ–‡', 'english': 'è‹±è¯­', 'french': 'æ³•è¯­', 'german': 'å¾·è¯­',
            'spanish': 'è¥¿ç­ç‰™è¯­', 'japanese': 'æ—¥è¯­', 'korean': 'éŸ©è¯­', 'russian': 'ä¿„è¯­',
            'arabic': 'é˜¿æ‹‰ä¼¯è¯­', 'portuguese': 'è‘¡è„ç‰™è¯­', 'italian': 'æ„å¤§åˆ©è¯­', 'dutch': 'è·å…°è¯­',
            'hindi': 'å°åœ°è¯­', 'turkish': 'åœŸè€³å…¶è¯­', 'vietnamese': 'è¶Šå—è¯­', 'thai': 'æ³°è¯­',
            'polish': 'æ³¢å…°è¯­', 'swedish': 'ç‘å…¸è¯­', 'norwegian': 'æŒªå¨è¯­', 'danish': 'ä¸¹éº¦è¯­',
            'finnish': 'èŠ¬å…°è¯­', 'greek': 'å¸Œè…Šè¯­', 'czech': 'æ·å…‹è¯­', 'hungarian': 'åŒˆç‰™åˆ©è¯­',
            'romanian': 'ç½—é©¬å°¼äºšè¯­', 'bulgarian': 'ä¿åŠ åˆ©äºšè¯­', 'croatian': 'å…‹ç½—åœ°äºšè¯­',
            'serbian': 'å¡å°”ç»´äºšè¯­', 'slovak': 'æ–¯æ´›ä¼å…‹è¯­', 'slovenian': 'æ–¯æ´›æ–‡å°¼äºšè¯­',
            'ukrainian': 'ä¹Œå…‹å…°è¯­', 'belarusian': 'ç™½ä¿„ç½—æ–¯è¯­', 'estonian': 'çˆ±æ²™å°¼äºšè¯­',
            'latvian': 'æ‹‰è„±ç»´äºšè¯­', 'lithuanian': 'ç«‹é™¶å®›è¯­', 'maltese': 'é©¬è€³ä»–è¯­'
        };

        // å›½å®¶åç§°ä¸­è‹±æ–‡æ˜ å°„
        const countryNameMapping = {
            'China': 'ä¸­å›½',
            'United States': 'ç¾å›½',
            'United Kingdom': 'è‹±å›½',
            'Japan': 'æ—¥æœ¬',
            'Germany': 'å¾·å›½',
            'France': 'æ³•å›½',
            'Australia': 'æ¾³å¤§åˆ©äºš',
            'Canada': 'åŠ æ‹¿å¤§',
            'Brazil': 'å·´è¥¿',
            'Russia': 'ä¿„ç½—æ–¯',
            'South Korea': 'éŸ©å›½',
            'India': 'å°åº¦',
            'Indonesia': 'å°åº¦å°¼è¥¿äºš',
            'Thailand': 'æ³°å›½',
            'Vietnam': 'è¶Šå—',
            'Malaysia': 'é©¬æ¥è¥¿äºš',
            'Philippines': 'è²å¾‹å®¾',
            'Singapore': 'æ–°åŠ å¡',
            'Taiwan': 'å°æ¹¾',
            'Hong Kong': 'é¦™æ¸¯',
            'Macao': 'æ¾³é—¨',
            'Netherlands': 'è·å…°',
            'Sweden': 'ç‘å…¸',
            'Norway': 'æŒªå¨',
            'Finland': 'èŠ¬å…°',
            'Denmark': 'ä¸¹éº¦',
            'Switzerland': 'ç‘å£«',
            'Austria': 'å¥¥åœ°åˆ©',
            'Belgium': 'æ¯”åˆ©æ—¶',
            'Ireland': 'çˆ±å°”å…°',
            'Portugal': 'è‘¡è„ç‰™',
            'Poland': 'æ³¢å…°',
            'Ukraine': 'ä¹Œå…‹å…°',
            'Czech Republic': 'æ·å…‹',
            'Hungary': 'åŒˆç‰™åˆ©',
            'Romania': 'ç½—é©¬å°¼äºš',
            'Greece': 'å¸Œè…Š',
            'Bulgaria': 'ä¿åŠ åˆ©äºš',
            'Serbia': 'å¡å°”ç»´äºš',
            'Croatia': 'å…‹ç½—åœ°äºš',
            'Slovakia': 'æ–¯æ´›ä¼å…‹',
            'Belarus': 'ç™½ä¿„ç½—æ–¯',
            'Lithuania': 'ç«‹é™¶å®›',
            'Latvia': 'æ‹‰è„±ç»´äºš',
            'Estonia': 'çˆ±æ²™å°¼äºš',
            'Slovenia': 'æ–¯æ´›æ–‡å°¼äºš',
            'Luxembourg': 'å¢æ£®å ¡',
            'Malta': 'é©¬è€³ä»–',
            'Cyprus': 'å¡æµ¦è·¯æ–¯',
            'Iceland': 'å†°å²›',
            'Albania': 'é˜¿å°”å·´å°¼äºš',
            'Mexico': 'å¢¨è¥¿å“¥',
            'Cuba': 'å¤å·´',
            'Dominican Republic': 'å¤šç±³å°¼åŠ ',
            'Haiti': 'æµ·åœ°',
            'Jamaica': 'ç‰™ä¹°åŠ ',
            'Argentina': 'é˜¿æ ¹å»·',
            'Chile': 'æ™ºåˆ©',
            'Colombia': 'å“¥ä¼¦æ¯”äºš',
            'Peru': 'ç§˜é²',
            'Venezuela': 'å§”å†…ç‘æ‹‰',
            'Ecuador': 'å„ç“œå¤šå°”',
            'Bolivia': 'ç»åˆ©ç»´äºš',
            'South Africa': 'å—é',
            'Egypt': 'åŸƒåŠ',
            'Nigeria': 'å°¼æ—¥åˆ©äºš',
            'Kenya': 'è‚¯å°¼äºš',
            'Morocco': 'æ‘©æ´›å“¥',
            'Ethiopia': 'åŸƒå¡ä¿„æ¯”äºš',
            'Ghana': 'åŠ çº³',
            'Tanzania': 'å¦æ¡‘å°¼äºš',
            'Algeria': 'é˜¿å°”åŠåˆ©äºš',
            'Uganda': 'ä¹Œå¹²è¾¾',
            'New Zealand': 'æ–°è¥¿å…°',
            'Fiji': 'æ–æµ',
            'Papua New Guinea': 'å·´å¸ƒäºšæ–°å‡ å†…äºš',
            'Samoa': 'è¨æ‘©äºš',
            'Tonga': 'æ±¤åŠ '
        };

        // æ‰©å±•ç±»å‹æ˜ å°„
        const genreMapping = {
            // éŸ³ä¹ç±»å‹
            'music': 'éŸ³ä¹', 'classical': 'å¤å…¸', 'rock': 'æ‘‡æ»š', 'pop': 'æµè¡Œ', 'jazz': 'çˆµå£«',
            'electronic': 'ç”µå­', 'country': 'ä¹¡æ‘', 'folk': 'æ°‘è°£', 'blues': 'è“è°ƒ', 'reggae': 'é›·é¬¼',
            'hiphop': 'å˜»å“ˆ', 'rap': 'è¯´å”±', 'metal': 'é‡‘å±', 'indie': 'ç‹¬ç«‹', 'dance': 'èˆæ›²',
            'house': 'æµ©å®¤', 'techno': 'ç§‘æŠ€', 'trance': 'è¿·å¹»', 'latin': 'æ‹‰ä¸', 'world': 'ä¸–ç•ŒéŸ³ä¹',
            'oldies': 'ç»å…¸è€æ­Œ', 'top40': 'æµè¡Œé‡‘æ›²', 'hits': 'çƒ­é—¨é‡‘æ›²', 'rnb': 'èŠ‚å¥è“è°ƒ', 
            'r&b': 'èŠ‚å¥è“è°ƒ', 'edm': 'ç”µå­èˆæ›²', 'kpop': 'éŸ©æµ', 'jpop': 'æ—¥æµ', 'cpop': 'åè¯­æµè¡Œ',
            
            // æ–°é—»èµ„è®¯
            'news': 'æ–°é—»', 'talk': 'è°ˆè¯', 'business': 'è´¢ç»', 'politics': 'æ”¿æ²»', 'sports': 'ä½“è‚²',
            'weather': 'å¤©æ°”', 'traffic': 'äº¤é€š', 'current affairs': 'æ—¶äº‹',
            
            // æ–‡åŒ–æ•™è‚²
            'education': 'æ•™è‚²', 'culture': 'æ–‡åŒ–', 'religious': 'å®—æ•™', 'history': 'å†å²',
            'science': 'ç§‘å­¦', 'technology': 'ç§‘æŠ€', 'arts': 'è‰ºæœ¯', 'literature': 'æ–‡å­¦',
            
            // å¨±ä¹ç”Ÿæ´»
            'entertainment': 'å¨±ä¹', 'comedy': 'å–œå‰§', 'lifestyle': 'ç”Ÿæ´»', 'health': 'å¥åº·',
            'fashion': 'æ—¶å°š', 'food': 'ç¾é£Ÿ', 'travel': 'æ—…æ¸¸', 'fitness': 'å¥èº«',
            
            // ç‰¹æ®Šç±»å‹
            'children': 'å„¿ç«¥', 'family': 'å®¶åº­', 'community': 'ç¤¾åŒº', 'local': 'æœ¬åœ°',
            'regional': 'åŒºåŸŸ', 'national': 'å…¨å›½', 'international': 'å›½é™…', 'public': 'å…¬å…±å¹¿æ’­',
            'college': 'å¤§å­¦ç”µå°', 'student': 'å­¦ç”Ÿç”µå°'
        };

        // çƒ­é—¨ç±»å‹åˆ—è¡¨
        const popularGenres = ['éŸ³ä¹', 'æ–°é—»', 'å¤å…¸', 'æ‘‡æ»š', 'æµè¡Œ', 'çˆµå£«', 'ç”µå­', 'è°ˆè¯', 'ä½“è‚²', 'æ•™è‚²'];

        // åœ°åŒºå›½å®¶æ˜ å°„ - 7ä¸ªæ´²
        const regionCountries = {
            'asia': ['China', 'Japan', 'South Korea', 'India', 'Indonesia', 'Thailand', 'Vietnam', 'Malaysia', 'Philippines', 'Singapore', 'Taiwan', 'Hong Kong', 'Macao'],
            'europe': ['United Kingdom', 'Germany', 'France', 'Italy', 'Spain', 'Netherlands', 'Sweden', 'Norway', 'Finland', 'Denmark', 'Switzerland', 'Austria', 'Russia'],
            'north-america': ['United States', 'Canada', 'Mexico', 'Cuba', 'Dominican Republic', 'Haiti', 'Jamaica'],
            'south-america': ['Brazil', 'Argentina', 'Chile', 'Colombia', 'Peru', 'Venezuela', 'Ecuador', 'Bolivia'],
            'africa': ['South Africa', 'Egypt', 'Nigeria', 'Kenya', 'Morocco', 'Ethiopia', 'Ghana', 'Tanzania', 'Algeria', 'Uganda'],
            'oceania': ['Australia', 'New Zealand', 'Fiji', 'Papua New Guinea', 'Samoa', 'Tonga']
        };

        // ä»é¢„å¤„ç†çš„JSONæ–‡ä»¶åŠ è½½æ•°æ® - ä¼˜åŒ–ç‰ˆæœ¬
        async function loadPreprocessedData() {
            console.log('å¼€å§‹åŠ è½½æ•°æ®...');
            const loadingElement = document.getElementById('radio-list');
            loadingElement.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> æ­£åœ¨åŠ è½½ç”µå°æ•°æ®...</div>';
            
            try {
                // é¦–å…ˆå°è¯•åŠ è½½ä¸»æ•°æ®æ–‡ä»¶
                let stations = await loadLocalDataFile(DATA_SOURCES.primary);
                
                if (stations && stations.length > 0) {
                    console.log(`âœ… ä»æœ¬åœ°ä¸»æ–‡ä»¶åŠ è½½äº† ${stations.length} ä¸ªç”µå°`);
                    processStationsData(stations);
                    updateDataSource('æœ¬åœ°æ•°æ®');
                    return;
                }
                
                // å¦‚æœä¸»æ–‡ä»¶ä¸å¯ç”¨ï¼Œå°è¯•åŠ è½½åˆ†åœ°åŒºæ•°æ®
                console.log('ä¸»æ•°æ®æ–‡ä»¶ä¸å¯ç”¨ï¼Œå°è¯•åŠ è½½åˆ†åœ°åŒºæ•°æ®...');
                stations = await loadRegionalData();
                
                if (stations && stations.length > 0) {
                    console.log(`âœ… ä»åœ°åŒºæ–‡ä»¶åŠ è½½äº† ${stations.length} ä¸ªç”µå°`);
                    processStationsData(stations);
                    updateDataSource('æœ¬åœ°æ•°æ® (åˆ†åœ°åŒº)');
                    return;
                }
                
                // å¦‚æœæœ¬åœ°æ•°æ®éƒ½ä¸å¯ç”¨ï¼Œä½¿ç”¨å¤‡ç”¨API
                console.log('æœ¬åœ°æ•°æ®ä¸å¯ç”¨ï¼Œä½¿ç”¨å¤‡ç”¨API...');
                await loadFallbackData();
                
            } catch (error) {
                console.error('æ•°æ®åŠ è½½å¤±è´¥:', error);
                await loadFallbackData();
            }
        }

        // åŠ è½½æœ¬åœ°æ•°æ®æ–‡ä»¶
        async function loadLocalDataFile(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                return data.stations || [];
            } catch (error) {
                console.warn(`æ— æ³•åŠ è½½ ${url}:`, error);
                return null;
            }
        }

        // åŠ è½½åœ°åŒºæ•°æ®
        async function loadRegionalData() {
            const regionalSources = [
                DATA_SOURCES.asia,
                DATA_SOURCES.europe,
                DATA_SOURCES['north-america'],
                DATA_SOURCES['south-america'],
                DATA_SOURCES.africa,
                DATA_SOURCES.oceania
            ];
            
            let allStations = [];
            
            for (const source of regionalSources) {
                try {
                    const stations = await loadLocalDataFile(source);
                    if (stations) {
                        allStations = allStations.concat(stations);
                        console.log(`âœ… ä» ${source} åŠ è½½äº† ${stations.length} ä¸ªç”µå°`);
                    }
                } catch (error) {
                    console.warn(`æ— æ³•åŠ è½½åœ°åŒºæ•°æ® ${source}:`, error);
                }
            }
            
            // å»é‡
            const uniqueStations = [];
            const seen = new Set();
            
            for (const station of allStations) {
                if (station.stationuuid && !seen.has(station.stationuuid)) {
                    seen.add(station.stationuuid);
                    uniqueStations.push(station);
                }
            }
            
            console.log(`ğŸ“Š åœ°åŒºæ•°æ®å»é‡å: ${uniqueStations.length} ä¸ªç”µå°`);
            return uniqueStations;
        }

        // åŠ è½½å¤‡ç”¨APIæ•°æ®
        async function loadFallbackData() {
            console.log('æ­£åœ¨ä»Radio Browser APIè·å–æ•°æ®...');
            updateDataSource('Radio Browser API');
            
            try {
                const response = await fetch(DATA_SOURCES.fallback);
                const stations = await response.json();
                
                if (stations && stations.length > 0) {
                    processStationsData(stations);
                    console.log(`âœ… ä»APIåŠ è½½äº† ${stations.length} ä¸ªç”µå°`);
                } else {
                    throw new Error('APIè¿”å›ç©ºæ•°æ®');
                }
            } catch (error) {
                console.error('å¤‡ç”¨APIåŠ è½½å¤±è´¥:', error);
                // æœ€åä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                const mockStations = generateMockStations();
                processStationsData(mockStations);
                updateDataSource('æ¨¡æ‹Ÿæ•°æ®');
            }
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿç”µå°æ•°æ®
        function generateMockStations() {
            const stations = [];
            const countries = ['ä¸­å›½', 'ç¾å›½', 'è‹±å›½', 'æ—¥æœ¬', 'å¾·å›½', 'æ³•å›½', 'æ¾³å¤§åˆ©äºš', 'åŠ æ‹¿å¤§', 'å·´è¥¿', 'ä¿„ç½—æ–¯'];
            const languages = ['ä¸­æ–‡', 'è‹±è¯­', 'æ—¥è¯­', 'å¾·è¯­', 'æ³•è¯­', 'è¥¿ç­ç‰™è¯­'];
            const genres = ['éŸ³ä¹', 'æ–°é—»', 'è°ˆè¯', 'ä½“è‚²', 'å¤å…¸', 'æ‘‡æ»š', 'æµè¡Œ', 'çˆµå£«', 'ç”µå­', 'æ•™è‚²'];
            
            for (let i = 1; i <= 100; i++) {
                const country = countries[Math.floor(Math.random() * countries.length)];
                const language = languages[Math.floor(Math.random() * languages.length)];
                const genre = genres[Math.floor(Math.random() * genres.length)];
                
                // æ¨¡æ‹ŸéŸ³è´¨ä¿¡æ¯
                const qualityTags = ['high', 'medium', 'low'];
                const quality = qualityTags[Math.floor(Math.random() * qualityTags.length)];
                
                stations.push({
                    stationuuid: `station-${i}`,
                    name: `${country}${genre}ç”µå°${i}`,
                    country: country,
                    countrycode: getCountryCode(country),
                    url_resolved: `https://example.com/stream${i}.mp3`,
                    tags: `${genre},${quality}`,
                    language: language,
                    votes: Math.floor(Math.random() * 1000),
                    geo_lat: 20 + Math.random() * 50,
                    geo_long: -120 + Math.random() * 240,
                    bitrate: quality === 'high' ? 320 : (quality === 'medium' ? 128 : 64)
                });
            }
            
            return stations;
        }

        // è·å–å›½å®¶ä»£ç 
        function getCountryCode(country) {
            const codes = {
                'ä¸­å›½': 'CN', 'ç¾å›½': 'US', 'è‹±å›½': 'GB', 'æ—¥æœ¬': 'JP', 
                'å¾·å›½': 'DE', 'æ³•å›½': 'FR', 'æ¾³å¤§åˆ©äºš': 'AU', 'åŠ æ‹¿å¤§': 'CA',
                'å·´è¥¿': 'BR', 'ä¿„ç½—æ–¯': 'RU'
            };
            return codes[country] || 'UN';
        }

        // å¤„ç†ç”µå°æ•°æ®
        function processStationsData(stations) {
            allStations = stations.filter(station => 
                station && (station.url_resolved || station.url)
            );
            
            updateStats();
            extractFilterOptions();
            
            displayedCount = 0;
            displayedStations = [];
            filteredStations = [...allStations];
            
            loadMoreStations();
            updateMapMarkers(allStations.slice(0, 500));
            
            console.log(`æˆåŠŸåŠ è½½ ${allStations.length} ä¸ªç”µå°`);
        }

        // æå–ç­›é€‰é€‰é¡¹
        function extractFilterOptions() {
            extractCountries();
            extractLanguages();
        }

        // åŠ è½½æ›´å¤šç”µå°
        function loadMoreStations() {
            const startIndex = displayedCount;
            const endIndex = Math.min(displayedCount + 200, filteredStations.length);
            
            if (startIndex >= filteredStations.length) {
                document.getElementById('load-more-btn').style.display = 'none';
                return;
            }
            
            const stationsToAdd = filteredStations.slice(startIndex, endIndex);
            displayedStations = displayedStations.concat(stationsToAdd);
            displayedCount = endIndex;
            
            renderRadioList(displayedStations, document.getElementById('radio-list'), 'all');
            updateStats();
            updateLoadMoreButton();
        }

        // æ›´æ–°åŠ è½½æ›´å¤šæŒ‰é’®
        function updateLoadMoreButton() {
            const loadMoreBtn = document.getElementById('load-more-btn');
            if (displayedCount >= filteredStations.length) {
                loadMoreBtn.style.display = 'none';
            } else {
                loadMoreBtn.style.display = 'block';
                const remaining = filteredStations.length - displayedCount;
                loadMoreBtn.textContent = `åŠ è½½æ›´å¤š (${remaining} ä¸ªç”µå°)`;
            }
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const totalDisplay = `${allStations.length.toLocaleString()} ç”µå° / ${countries.length} å›½å®¶`;
            document.getElementById('total-stations').textContent = totalDisplay;
            
            const currentDisplayCount = Math.min(displayedCount, filteredStations.length);
            const displayedCountText = `æ˜¾ç¤º: ${currentDisplayCount}/${filteredStations.length}`;
            document.getElementById('filtered-stations').textContent = displayedCountText;
        }

        // æ ¼å¼åŒ–ç±»å‹æ˜¾ç¤º
        function formatGenre(genre) {
            const genreLower = genre.toLowerCase();
            if (genreMapping[genreLower]) {
                return genreMapping[genreLower];
            }
            
            // æ¨¡ç³ŠåŒ¹é…
            const fuzzyMap = {
                'oldies': 'ç»å…¸è€æ­Œ', 'top40': 'æµè¡Œé‡‘æ›²', 'hits': 'çƒ­é—¨é‡‘æ›²',
                'rnb': 'èŠ‚å¥è“è°ƒ', 'r&b': 'èŠ‚å¥è“è°ƒ', 'edm': 'ç”µå­èˆæ›²',
                'kpop': 'éŸ©æµ', 'jpop': 'æ—¥æµ', 'cpop': 'åè¯­æµè¡Œ'
            };
            
            for (const [key, value] of Object.entries(fuzzyMap)) {
                if (genreLower.includes(key)) {
                    return value;
                }
            }
            
            return genre;
        }

        // æ ¼å¼åŒ–æ ‡ç­¾æ˜¾ç¤º
        function formatGenres(tags) {
            if (!tags) return 'æœªåˆ†ç±»';
            
            const genreList = tags.split(',').slice(0, 2).map(genre => {
                return formatGenre(genre.trim());
            });
            
            return genreList.join(' Â· ');
        }

        // æ›´æ–°æ•°æ®æºæ˜¾ç¤º
        function updateDataSource(source) {
            const sourceElement = document.getElementById('data-source');
            if (sourceElement) {
                sourceElement.textContent = `æ•°æ®æ¥æº: ${source}`;
            }
        }

        // æå–å›½å®¶åˆ—è¡¨
        function extractCountries() {
            const countrySet = new Set();
            allStations.forEach(station => {
                if (station.country) {
                    // å°†è‹±æ–‡å›½å®¶åè½¬æ¢ä¸ºä¸­æ–‡
                    const chineseName = countryNameMapping[station.country] || station.country;
                    countrySet.add(chineseName);
                }
            });
            
            countries = Array.from(countrySet).sort();
            
            const countryFilter = document.getElementById('country-filter');
            countryFilter.innerHTML = '<option value="">æ‰€æœ‰å›½å®¶</option>';
            
            countries.forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                countryFilter.appendChild(option);
            });
        }

        // æå–è¯­è¨€åˆ—è¡¨
        function extractLanguages() {
            const languageSet = new Set();
            
            allStations.forEach(station => {
                if (station.language) {
                    const stationLanguages = station.language.split(',').map(lang => lang.trim().toLowerCase());
                    stationLanguages.forEach(lang => {
                        if (lang && languageMapping[lang]) {
                            languageSet.add(languageMapping[lang]);
                        }
                    });
                }
            });
            
            languages = Array.from(languageSet).sort();
            
            const languageFilter = document.getElementById('language-filter');
            languageFilter.innerHTML = '<option value="">æ‰€æœ‰è¯­è¨€</option>';
            
            languages.forEach(language => {
                const option = document.createElement('option');
                option.value = language;
                option.textContent = language;
                languageFilter.appendChild(option);
            });
        }

        // æ¸²æŸ“ç”µå°åˆ—è¡¨
        function renderRadioList(stations = displayedStations, container = document.getElementById('radio-list'), listType = 'all') {
            if (!container) return;
            
            if (stations.length === 0) {
                if (listType === 'favorites') {
                    container.innerHTML = '<div class="loading">æš‚æ— æ”¶è—çš„ç”µå°</div>';
                } else if (listType === 'history') {
                    container.innerHTML = '<div class="loading">æš‚æ— æ’­æ”¾å†å²</div>';
                } else {
                    container.innerHTML = '<div class="loading">æœªæ‰¾åˆ°åŒ¹é…çš„ç”µå°</div>';
                }
                return;
            }
            
            container.innerHTML = '';
            
            stations.forEach(station => {
                const radioItem = document.createElement('div');
                radioItem.className = 'radio-item';
                if (currentStation && currentStation.stationuuid === station.stationuuid) {
                    radioItem.classList.add('active');
                }
                radioItem.dataset.id = station.stationuuid;
                
                const flagEmoji = getFlagEmoji(station.countrycode);
                const isFavorite = favoriteStations.some(fav => fav.stationuuid === station.stationuuid);
                
                // å°†å›½å®¶åè½¬æ¢ä¸ºä¸­æ–‡æ˜¾ç¤º
                const countryName = countryNameMapping[station.country] || station.country;
                
                radioItem.innerHTML = `
                    <button class="favorite-btn ${isFavorite ? 'active' : ''}" data-id="${station.stationuuid}">
                        <i class="fas fa-heart"></i>
                    </button>
                    <div class="radio-flag">${flagEmoji}</div>
                    <div class="radio-info">
                        <div class="radio-name">${station.name || 'æœªçŸ¥ç”µå°'}</div>
                        <div class="radio-country">${countryName || 'æœªçŸ¥å›½å®¶'}</div>
                        <div class="radio-genre">${formatGenres(station.tags)}</div>
                    </div>
                    <button class="play-btn" data-id="${station.stationuuid}">
                        <i class="fas fa-play"></i>
                    </button>
                `;
                
                container.appendChild(radioItem);
            });
            
            attachEventListeners();
        }

        // é™„åŠ äº‹ä»¶ç›‘å¬å™¨
        function attachEventListeners() {
            document.querySelectorAll('.play-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const stationId = this.dataset.id;
                    playStation(stationId);
                });
            });
            
            document.querySelectorAll('.favorite-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const stationId = this.dataset.id;
                    toggleFavorite(stationId);
                });
            });
            
            document.querySelectorAll('.radio-item').forEach(item => {
                item.addEventListener('click', function() {
                    const stationId = this.dataset.id;
                    playStation(stationId);
                });
            });
        }

        // æ’­æ”¾ç”µå°
        function playStation(stationId) {
            const station = allStations.find(s => s.stationuuid === stationId);
            if (!station) return;
            
            currentStation = station;
            document.getElementById('current-station').textContent = station.name || 'æœªçŸ¥ç”µå°';
            
            // å°†å›½å®¶åè½¬æ¢ä¸ºä¸­æ–‡æ˜¾ç¤º
            const countryName = countryNameMapping[station.country] || station.country;
            document.getElementById('current-country').textContent = `${countryName || 'æœªçŸ¥å›½å®¶'} â€¢ ${formatGenres(station.tags)}`;
            
            const playPauseBtn = document.getElementById('play-pause-btn');
            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            isPlaying = true;
            
            addToHistory(station);
            
            document.querySelectorAll('.radio-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.id === stationId) {
                    item.classList.add('active');
                }
            });
            
            // æ£€æµ‹å¹¶æ˜¾ç¤ºéŸ³è´¨ä¿¡æ¯
            detectAndDisplayQuality(station);
            
            // ä¿®å¤ï¼šåœ°å›¾è·³è½¬åˆ°ç”µå°ä½ç½®
            if (station.geo_lat && station.geo_long) {
                map.setView([station.geo_lat, station.geo_long], 6, {
                    animate: true,
                    duration: 1
                });
                
                // é«˜äº®å¯¹åº”çš„åœ°å›¾æ ‡è®°
                markers.forEach(marker => {
                    const markerLat = marker.getLatLng().lat;
                    const markerLng = marker.getLatLng().lng;
                    if (markerLat === station.geo_lat && markerLng === station.geo_long) {
                        marker.openPopup();
                    }
                });
            }
            
            audioPlayer.pause();
            
            const streamUrl = station.url_resolved || station.url;
            audioPlayer.src = streamUrl;
            audioPlayer.play().catch(error => {
                console.error('æ’­æ”¾å¤±è´¥:', error);
                document.getElementById('current-station').textContent = 'æ’­æ”¾å¤±è´¥ï¼Œè¯·å°è¯•å…¶ä»–ç”µå°';
                document.getElementById('current-station').style.color = '#e52e71';
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                isPlaying = false;
                
                setTimeout(() => {
                    if (document.getElementById('current-station')) {
                        document.getElementById('current-station').style.color = '';
                    }
                }, 3000);
            });
        }

        // æ£€æµ‹å¹¶æ˜¾ç¤ºéŸ³è´¨ä¿¡æ¯
        function detectAndDisplayQuality(station) {
            const qualityIndicator = document.getElementById('quality-indicator');
            let quality = 'æœªçŸ¥';
            
            // ä»æ ‡ç­¾ä¸­æ£€æµ‹éŸ³è´¨ä¿¡æ¯
            if (station.tags) {
                const tags = station.tags.toLowerCase().split(',');
                if (tags.includes('high') || tags.includes('hq') || tags.includes('320')) {
                    quality = 'é«˜éŸ³è´¨';
                } else if (tags.includes('medium') || tags.includes('128')) {
                    quality = 'ä¸­éŸ³è´¨';
                } else if (tags.includes('low') || tags.includes('64')) {
                    quality = 'ä½éŸ³è´¨';
                }
            }
            
            // ä»æ¯”ç‰¹ç‡æ£€æµ‹éŸ³è´¨
            if (station.bitrate) {
                if (station.bitrate >= 256) {
                    quality = 'é«˜éŸ³è´¨';
                } else if (station.bitrate >= 128) {
                    quality = 'ä¸­éŸ³è´¨';
                } else {
                    quality = 'ä½éŸ³è´¨';
                }
            }
            
            qualityIndicator.textContent = `(${quality})`;
        }

        // åˆå§‹åŒ–åœ°å›¾
        function initMap() {
            map = L.map('map').setView([20, 0], 3);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            // æ·»åŠ åœ°å›¾ç‚¹å‡»äº‹ä»¶
            map.on('click', function(e) {
                // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
                document.querySelectorAll('.radio-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // æŸ¥æ‰¾é™„è¿‘çš„ç”µå°
                const nearbyStations = findStationsNearLocation(e.latlng.lat, e.latlng.lng, 500);
                
                if (nearbyStations.length > 0) {
                    // æ›´æ–°ç”µå°åˆ—è¡¨æ˜¾ç¤ºé™„è¿‘çš„ç”µå°
                    filteredStations = nearbyStations;
                    displayedCount = 0;
                    displayedStations = [];
                    
                    if (activeTab === 'all') {
                        loadMoreStations();
                    }
                    
                    // æ›´æ–°å›½å®¶ä¿¡æ¯
                    document.getElementById('selected-country').textContent = 'é™„è¿‘ç”µå°';
                    document.getElementById('country-station-count').textContent = `æ‰¾åˆ° ${nearbyStations.length} ä¸ªç”µå°`;
                    
                    // æ›´æ–°åœ°å›¾æ ‡è®°
                    updateMapMarkers(nearbyStations.slice(0, 200));
                }
            });
        }

        // æŸ¥æ‰¾é™„è¿‘ç”µå°
        function findStationsNearLocation(lat, lng, radiusKm) {
            return allStations.filter(station => {
                if (!station.geo_lat || !station.geo_long) return false;
                
                const distance = calculateDistance(lat, lng, station.geo_lat, station.geo_long);
                return distance <= radiusKm;
            });
        }

        // è®¡ç®—ä¸¤ç‚¹é—´è·ç¦»ï¼ˆå…¬é‡Œï¼‰
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // æ›´æ–°åœ°å›¾æ ‡è®°
        function updateMapMarkers(stations) {
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
            
            stations.forEach(station => {
                if (station.geo_lat && station.geo_long) {
                    const flagEmoji = getFlagEmoji(station.countrycode);
                    const countryName = countryNameMapping[station.country] || station.country;
                    
                    const marker = L.marker([station.geo_lat, station.geo_long])
                        .addTo(map)
                        .bindPopup(`
                            <div style="color: black; min-width: 200px;">
                                <b>${station.name || 'æœªçŸ¥ç”µå°'}</b><br>
                                ${countryName || ''}<br>
                                <small>${formatGenres(station.tags)}</small><br>
                                <button onclick="window.playStationFromMap('${station.stationuuid}')" 
                                        style="background:#e52e71;color:white;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;margin-top:5px;">
                                    æ’­æ”¾
                                </button>
                            </div>
                        `);
                    
                    markers.push(marker);
                }
            });
        }

        // ä»åœ°å›¾æ’­æ”¾ç”µå°
        window.playStationFromMap = function(stationId) {
            playStation(stationId);
        };

        // é˜²æŠ–æœç´¢
        function debounceSearch() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(performSearch, 300);
        }

        // æ‰§è¡Œæœç´¢
        function performSearch() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const countryFilter = document.getElementById('country-filter').value;
            const languageFilter = document.getElementById('language-filter').value;
            
            filteredStations = allStations.filter(station => {
                const matchesSearch = searchTerm === '' || 
                    (station.name && station.name.toLowerCase().includes(searchTerm)) || 
                    (station.country && station.country.toLowerCase().includes(searchTerm)) ||
                    (station.tags && station.tags.toLowerCase().includes(searchTerm));
                
                // å›½å®¶ç­›é€‰ - æ”¯æŒä¸­è‹±æ–‡åŒ¹é…
                let matchesCountry = true;
                if (countryFilter !== '') {
                    const englishCountryName = Object.keys(countryNameMapping).find(
                        key => countryNameMapping[key] === countryFilter
                    ) || countryFilter;
                    matchesCountry = station.country && (
                        station.country.toLowerCase().includes(englishCountryName.toLowerCase()) ||
                        (countryNameMapping[station.country] && countryNameMapping[station.country] === countryFilter)
                    );
                }
                
                let matchesLanguage = true;
                if (languageFilter !== '') {
                    const englishKeyword = Object.keys(languageMapping).find(key => 
                        languageMapping[key] === languageFilter
                    ) || '';
                    matchesLanguage = station.language && 
                        station.language.toLowerCase().includes(englishKeyword.toLowerCase());
                }
                
                let matchesGenre = true;
                if (currentGenre !== 'all' && currentGenre !== '') {
                    const englishKeyword = Object.keys(genreMapping).find(key => 
                        genreMapping[key] === currentGenre
                    ) || '';
                    matchesGenre = station.tags && 
                        station.tags.toLowerCase().includes(englishKeyword.toLowerCase());
                }
                
                // ä¿®å¤ï¼šåœ°åŒºç­›é€‰
                let matchesRegion = true;
                if (currentRegion !== 'all') {
                    const regionCountriesList = getRegionCountries(currentRegion);
                    matchesRegion = regionCountriesList.some(country => 
                        station.country && station.country.toLowerCase().includes(country.toLowerCase())
                    );
                }
                
                // éŸ³è´¨ç­›é€‰
                let matchesQuality = true;
                if (currentQuality !== 'auto') {
                    if (currentQuality === 'high') {
                        matchesQuality = station.tags && (
                            station.tags.toLowerCase().includes('high') || 
                            station.tags.toLowerCase().includes('hq') ||
                            station.tags.toLowerCase().includes('320')
                        );
                    } else if (currentQuality === 'medium') {
                        matchesQuality = station.tags && (
                            station.tags.toLowerCase().includes('medium') || 
                            station.tags.toLowerCase().includes('128')
                        );
                    } else if (currentQuality === 'low') {
                        matchesQuality = station.tags && (
                            station.tags.toLowerCase().includes('low') || 
                            station.tags.toLowerCase().includes('64')
                        );
                    }
                }
                
                return matchesSearch && matchesCountry && matchesLanguage && matchesGenre && matchesRegion && matchesQuality;
            });
            
            displayedCount = 0;
            displayedStations = [];
            
            if (activeTab === 'all') {
                loadMoreStations();
            }
            
            updateMapMarkers(filteredStations.slice(0, 200));
            updateCountryInfo();
        }

        // è·å–åœ°åŒºå¯¹åº”çš„å›½å®¶åˆ—è¡¨
        function getRegionCountries(region) {
            return regionCountries[region] || [];
        }

        // æ›´æ–°å›½å®¶ä¿¡æ¯æ˜¾ç¤º
        function updateCountryInfo() {
            const countryName = document.getElementById('selected-country');
            const countryCount = document.getElementById('country-station-count');
            
            if (currentRegion !== 'all') {
                const regionNames = {
                    'asia': 'äºšæ´²', 'europe': 'æ¬§æ´²', 'africa': 'éæ´²', 
                    'north-america': 'åŒ—ç¾æ´²', 'south-america': 'å—ç¾æ´²', 'oceania': 'å¤§æ´‹æ´²'
                };
                countryName.textContent = `${regionNames[currentRegion]}åœ°åŒºç”µå°`;
                countryCount.textContent = `æ‰¾åˆ° ${filteredStations.length} ä¸ªç”µå°`;
                
                // æ›´æ–°å›½å®¶ç­›é€‰å™¨ä¸ºå½“å‰åœ°åŒºçš„å›½å®¶
                updateCountryFilterForRegion(currentRegion);
            } else if (document.getElementById('country-filter').value) {
                const selectedCountry = document.getElementById('country-filter').value;
                countryName.textContent = `${selectedCountry}ç”µå°`;
                countryCount.textContent = `æ‰¾åˆ° ${filteredStations.length} ä¸ªç”µå°`;
            } else {
                countryName.textContent = 'å…¨çƒç”µå°';
                countryCount.textContent = `ç‚¹å‡»åœ°å›¾ä¸Šçš„æ ‡è®°æˆ–ä½¿ç”¨ç­›é€‰å™¨é€‰æ‹©ç”µå° (${filteredStations.length} ä¸ªç”µå°)`;
                
                // é‡ç½®å›½å®¶ç­›é€‰å™¨ä¸ºæ‰€æœ‰å›½å®¶
                resetCountryFilter();
            }
        }

        // æ›´æ–°å›½å®¶ç­›é€‰å™¨ä¸ºæŒ‡å®šåœ°åŒºçš„å›½å®¶
        function updateCountryFilterForRegion(region) {
            const regionCountriesList = getRegionCountries(region);
            const countryFilter = document.getElementById('country-filter');
            
            // ä¿å­˜å½“å‰é€‰ä¸­çš„å›½å®¶
            const currentSelected = countryFilter.value;
            
            countryFilter.innerHTML = '<option value="">æ‰€æœ‰å›½å®¶</option>';
            
            // è·å–è¯¥åœ°åŒºå›½å®¶çš„ä¸­æ–‡åç§°
            const regionCountryNames = regionCountriesList.map(country => 
                countryNameMapping[country] || country
            ).sort();
            
            regionCountryNames.forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                countryFilter.appendChild(option);
            });
            
            // å¦‚æœä¹‹å‰é€‰ä¸­çš„å›½å®¶åœ¨å½“å‰åœ°åŒºä¸­ï¼Œä¿æŒé€‰ä¸­çŠ¶æ€
            if (regionCountryNames.includes(currentSelected)) {
                countryFilter.value = currentSelected;
            } else {
                countryFilter.value = '';
            }
        }

        // é‡ç½®å›½å®¶ç­›é€‰å™¨ä¸ºæ‰€æœ‰å›½å®¶
        function resetCountryFilter() {
            const countryFilter = document.getElementById('country-filter');
            const currentSelected = countryFilter.value;
            
            countryFilter.innerHTML = '<option value="">æ‰€æœ‰å›½å®¶</option>';
            
            countries.forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                countryFilter.appendChild(option);
            });
            
            // ä¿æŒä¹‹å‰é€‰ä¸­çš„å›½å®¶
            if (countries.includes(currentSelected)) {
                countryFilter.value = currentSelected;
            }
        }

        // åŠ è½½æœ¬åœ°æ•°æ®
        function loadLocalData() {
            const storedFavorites = localStorage.getItem('radioFavorites');
            const storedHistory = localStorage.getItem('radioHistory');
            
            if (storedFavorites) {
                favoriteStations = JSON.parse(storedFavorites);
            }
            
            if (storedHistory) {
                historyStations = JSON.parse(storedHistory);
            }
        }

        // ä¿å­˜æ•°æ®åˆ°localStorage
        function saveLocalData() {
            localStorage.setItem('radioFavorites', JSON.stringify(favoriteStations));
            localStorage.setItem('radioHistory', JSON.stringify(historyStations));
        }

        // åˆ‡æ¢æ”¶è—çŠ¶æ€
        function toggleFavorite(stationId) {
            const station = allStations.find(s => s.stationuuid === stationId);
            if (!station) return;
            
            const index = favoriteStations.findIndex(fav => fav.stationuuid === stationId);
            
            if (index === -1) {
                favoriteStations.push(station);
            } else {
                favoriteStations.splice(index, 1);
            }
            
            saveLocalData();
            
            if (activeTab === 'all') {
                renderRadioList();
            } else if (activeTab === 'favorites') {
                updateTabs();
            }
        }

        // æ·»åŠ åˆ°æ’­æ”¾å†å²
        function addToHistory(station) {
            const existingIndex = historyStations.findIndex(item => 
                item.station.stationuuid === station.stationuuid
            );
            
            if (existingIndex !== -1) {
                historyStations.splice(existingIndex, 1);
            }
            
            historyStations.push({
                station: station,
                timestamp: Date.now()
            });
            
            if (historyStations.length > 50) {
                historyStations = historyStations.slice(-50);
            }
            
            saveLocalData();
            
            if (activeTab === 'history') {
                updateTabs();
            }
        }

        // æ ¹æ®å›½å®¶ä»£ç è·å–å›½æ——emoji
        function getFlagEmoji(countryCode) {
            if (!countryCode) return 'ğŸŒ';
            
            const codePoints = countryCode
                .toUpperCase()
                .split('')
                .map(char => 127397 + char.charCodeAt());
            return String.fromCodePoint(...codePoints);
        }

        // æ›´æ–°æ ‡ç­¾é¡µå†…å®¹
        function updateTabs() {
            if (activeTab === 'favorites') {
                renderRadioList(favoriteStations, document.getElementById('favorites-list'), 'favorites');
            } else if (activeTab === 'history') {
                renderHistoryList();
            }
        }

        // æ¸²æŸ“å†å²åˆ—è¡¨
        function renderHistoryList() {
            const historyList = document.getElementById('history-list');
            
            if (historyStations.length === 0) {
                historyList.innerHTML = '<div class="loading">æš‚æ— æ’­æ”¾å†å²</div>';
                return;
            }
            
            historyList.innerHTML = '';
            
            const recentHistory = historyStations.slice(-20).reverse();
            
            recentHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.dataset.id = item.station.stationuuid;
                
                const flagEmoji = getFlagEmoji(item.station.countrycode);
                const timeString = new Date(item.timestamp).toLocaleString();
                const countryName = countryNameMapping[item.station.country] || item.station.country;
                
                historyItem.innerHTML = `
                    <div class="radio-flag">${flagEmoji}</div>
                    <div class="radio-info">
                        <div class="radio-name">${item.station.name || 'æœªçŸ¥ç”µå°'}</div>
                        <div class="radio-country">${countryName || 'æœªçŸ¥å›½å®¶'}</div>
                        <div class="history-time">${timeString}</div>
                    </div>
                    <button class="play-btn" data-id="${item.station.stationuuid}">
                        <i class="fas fa-play"></i>
                    </button>
                `;
                
                historyList.appendChild(historyItem);
            });
            
            attachEventListeners();
        }

        // æ’­æ”¾æ§åˆ¶
        function togglePlayPause() {
            if (!currentStation) {
                if (filteredStations.length > 0) {
                    playStation(filteredStations[0].stationuuid);
                }
                return;
            }
            
            if (isPlaying) {
                document.getElementById('play-pause-btn').innerHTML = '<i class="fas fa-play"></i>';
                audioPlayer.pause();
            } else {
                document.getElementById('play-pause-btn').innerHTML = '<i class="fas fa-pause"></i>';
                audioPlayer.play().catch(error => {
                    console.error('æ’­æ”¾å¤±è´¥:', error);
                    document.getElementById('play-pause-btn').innerHTML = '<i class="fas fa-play"></i>';
                });
            }
            
            isPlaying = !isPlaying;
        }

        function stopPlayback() {
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
            isPlaying = false;
            document.getElementById('play-pause-btn').innerHTML = '<i class="fas fa-play"></i>';
        }

        function updateVolume() {
            audioPlayer.volume = document.querySelector('.volume-slider').value / 100;
        }

        // åˆ†äº«åŠŸèƒ½
        function toggleShareMenu() {
            const shareMenu = document.getElementById('share-menu');
            shareMenu.classList.toggle('active');
        }

        function shareStation(platform) {
            if (!currentStation) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç”µå°');
                return;
            }
            
            const stationName = currentStation.name;
            const stationUrl = currentStation.url_resolved || currentStation.url;
            const shareText = `æˆ‘æ­£åœ¨æ”¶å¬ ${stationName} ç”µå°`;
            
            let shareUrl = '';
            
            switch(platform) {
                case 'wechat':
                    alert('è¯·ä½¿ç”¨å¾®ä¿¡å†…ç½®åˆ†äº«åŠŸèƒ½');
                    break;
                case 'weibo':
                    shareUrl = `https://service.weibo.com/share/share.php?url=${encodeURIComponent(stationUrl)}&title=${encodeURIComponent(shareText)}`;
                    window.open(shareUrl, '_blank');
                    break;
                case 'qq':
                    shareUrl = `https://connect.qq.com/widget/shareqq/index.html?url=${encodeURIComponent(stationUrl)}&title=${encodeURIComponent(shareText)}`;
                    window.open(shareUrl, '_blank');
                    break;
                case 'zhihu':
                    shareUrl = `https://www.zhihu.com/question/48510028`;
                    window.open(shareUrl, '_blank');
                    break;
                case 'redbook':
                    alert('è¯·ä½¿ç”¨å°çº¢ä¹¦å†…ç½®åˆ†äº«åŠŸèƒ½');
                    break;
                case 'twitter':
                    shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(stationUrl)}`;
                    window.open(shareUrl, '_blank');
                    break;
                case 'facebook':
                    shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(stationUrl)}`;
                    window.open(shareUrl, '_blank');
                    break;
                case 'copy':
                    navigator.clipboard.writeText(`${shareText} - ${stationUrl}`).then(() => {
                        alert('ç”µå°é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                    }).catch(() => {
                        // å¤‡ç”¨æ–¹æ¡ˆ
                        const textArea = document.createElement('textarea');
                        textArea.value = `${shareText} - ${stationUrl}`;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        alert('ç”µå°é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                    });
                    break;
            }
            
            // å…³é—­åˆ†äº«èœå•
            document.getElementById('share-menu').classList.remove('active');
        }

        // è‡ªå®šä¹‰ä¸‹æ‹‰èœå•åŠŸèƒ½
        function initCustomSelect() {
            const customSelect = document.getElementById('genre-select');
            const selectSelected = customSelect.querySelector('.select-selected');
            const selectItems = customSelect.querySelector('.select-items');
            const selectItemsAll = customSelect.querySelectorAll('.select-item');
            
            // è®¾ç½®"æ‰€æœ‰ç±»å‹"ä¸ºé»˜è®¤é€‰ä¸­
            selectItemsAll.forEach(item => {
                if (item.dataset.value === 'all') {
                    item.classList.add('active');
                }
            });
            
            // ç‚¹å‡»é€‰æ‹©å™¨æ˜¾ç¤º/éšè—ä¸‹æ‹‰èœå•
            selectSelected.addEventListener('click', function(e) {
                e.stopPropagation();
                selectItems.classList.toggle('active');
                this.classList.toggle('select-arrow-active');
            });
            
            // ç‚¹å‡»é€‰é¡¹
            selectItemsAll.forEach(item => {
                item.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰é€‰é¡¹çš„activeç±»
                    selectItemsAll.forEach(i => i.classList.remove('active'));
                    // æ·»åŠ å½“å‰é€‰é¡¹çš„activeç±»
                    this.classList.add('active');
                    // æ›´æ–°é€‰æ‹©å™¨æ˜¾ç¤ºæ–‡æœ¬
                    selectSelected.textContent = this.textContent;
                    // æ›´æ–°å½“å‰é€‰æ‹©çš„ç±»å‹
                    currentGenre = this.dataset.value;
                    // å…³é—­ä¸‹æ‹‰èœå•
                    selectItems.classList.remove('active');
                    selectSelected.classList.remove('select-arrow-active');
                    // æ‰§è¡Œæœç´¢
                    performSearch();
                });
            });
            
            // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­ä¸‹æ‹‰èœå•
            document.addEventListener('click', function() {
                selectItems.classList.remove('active');
                selectSelected.classList.remove('select-arrow-active');
            });
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            loadLocalData();
            loadPreprocessedData();
            initCustomSelect();
            
            // äº‹ä»¶ç›‘å¬å™¨
            document.getElementById('search-input').addEventListener('input', debounceSearch);
            document.getElementById('country-filter').addEventListener('change', performSearch);
            document.getElementById('language-filter').addEventListener('change', performSearch);
            document.getElementById('load-more-btn').addEventListener('click', loadMoreStations);

            // åœ°åŒºé€‰æ‹©è”åŠ¨
            document.querySelectorAll('.region-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.region-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentRegion = this.dataset.region;
                    
                    performSearch();
                    updateCountryInfo();
                });
            });

            // éŸ³è´¨é€‰æ‹©
            document.getElementById('quality-select').addEventListener('change', function() {
                currentQuality = this.value;
                performSearch();
            });

            // åˆ†äº«åŠŸèƒ½
            document.getElementById('share-btn').addEventListener('click', toggleShareMenu);
            document.querySelectorAll('.share-option').forEach(option => {
                option.addEventListener('click', function(e) {
                    e.preventDefault();
                    const platform = this.dataset.platform;
                    shareStation(platform);
                });
            });

            // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­åˆ†äº«èœå•
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.share-container')) {
                    document.getElementById('share-menu').classList.remove('active');
                }
            });

            // æ ‡ç­¾é¡µåˆ‡æ¢
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    const tabId = this.dataset.tab;
                    document.getElementById(`${tabId}-stations`).classList.add('active');
                    
                    activeTab = tabId;
                    updateTabs();
                });
            });

            // æ’­æ”¾æ§åˆ¶
            document.getElementById('play-pause-btn').addEventListener('click', togglePlayPause);
            document.getElementById('stop-btn').addEventListener('click', stopPlayback);
            document.querySelector('.volume-slider').addEventListener('input', updateVolume);
        });
    </script>
</body>
</html>
